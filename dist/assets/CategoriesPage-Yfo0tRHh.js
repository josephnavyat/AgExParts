import{r as c,j as a,L as x}from"./index-gi7GTMaL.js";import{g as j}from"./imageUrl-CI4-tccc.js";function v(){const[f,u]=c.useState(!0),[y,h]=c.useState([]);c.useEffect(()=>{let t=!0;return(async()=>{try{const i=await fetch("/.netlify/functions/get-data");if(!i.ok)throw new Error("fetch failed");const s=await i.json();let m=[];Array.isArray(s)?m=s:s&&Array.isArray(s.products)&&(m=s.products);const l=new Map,g=e=>{if(!e)return null;if(typeof e.image=="string"&&e.image.trim())return e.image.trim();if(Array.isArray(e.images)&&e.images.length&&typeof e.images[0]=="string")return e.images[0];if(Array.isArray(e.gallery)&&e.gallery.length&&typeof e.gallery[0]=="string")return e.gallery[0];if(Array.isArray(e.photos)&&e.photos.length&&typeof e.photos[0]=="string")return e.photos[0];const n=["images","gallery","photos"];for(const r of n)if(Array.isArray(e[r])&&e[r].length){const o=e[r][0];if(o&&typeof o=="object"){if(o.src)return o.src;if(o.url)return o.url}}return null};for(const e of m){const n=(e.category||"").trim();if(!n)continue;l.has(n)||l.set(n,{sample:e,count:0,img:g(e)});const r=l.get(n);r.count=(r.count||0)+1,r.img||(r.img=g(e)),(!r.sample||!g(r.sample))&&(r.sample=e)}const d=Array.from(l.entries()).map(([e,n])=>({category:e,sample:n.sample,sampleImage:n.img}));t&&h(d)}catch(i){console.error("CategoriesPage fetch failed",i)}finally{t&&u(!1)}})(),()=>{t=!1}},[]);const p=t=>j(t);return c.useEffect(()=>{const t=()=>{try{const s=document.querySelector(".main-content > h2");s&&s.scrollIntoView&&s.scrollIntoView({block:"start"})}catch{}};requestAnimationFrame(()=>setTimeout(t,40));const i=setTimeout(t,300);return()=>clearTimeout(i)},[]),a.jsxs("section",{className:"main-content",style:{padding:"28px 20px",maxWidth:1200,margin:"0 auto"},children:[a.jsx("h2",{className:"category-page__title",style:{marginBottom:12},children:"Categories"}),f&&a.jsx("div",{className:"muted",children:"Loadingâ€¦"}),!f&&y.length===0&&a.jsx("div",{className:"muted",children:"No categories found."}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginTop:12},children:y.map(t=>a.jsxs(x,{id:t.category?String(t.category).replace(/\s+/g,"-"):void 0,to:`/categories/${encodeURIComponent(t.category)}`,className:"card",style:{display:"block",textDecoration:"none",color:"inherit"},children:[a.jsx("div",{style:{height:140,background:"#f4f4f4",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:t.sampleImage||t.sample&&t.sample.image?a.jsx("img",{src:p(t.sampleImage||t.sample&&t.sample.image),alt:t.category,loading:"lazy",onError:i=>{i.currentTarget.onerror=null,i.currentTarget.src="/logo.png"},style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}}):a.jsx("div",{style:{color:"#777"},children:"No image"})}),a.jsx("div",{style:{padding:"12px"},children:a.jsx("h3",{style:{margin:0,fontSize:"1rem"},children:t.category})})]},t.category))})]})}export{v as default};
