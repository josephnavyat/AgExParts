import{u as C,b as T,r as S,R as A,j as e,c as W}from"./index-CxIS0fO9.js";import{F as _}from"./Footer-6bmIf-31.js";import{g as N}from"./getImageUrl-uc-Sp53x.js";function z({cart:n,disabled:u}){W();const f=T(),y=async d=>(window.turnstile||await new Promise((l,s)=>{const i=document.querySelector('script[src*="challenges.cloudflare.com/turnstile"]');if(i){i.addEventListener("load",l),i.addEventListener("error",s);return}const r=document.createElement("script");r.src="https://challenges.cloudflare.com/turnstile/v0/api.js",r.async=!0,r.onload=l,r.onerror=s,document.head.appendChild(r)}),await new Promise((l,s)=>{let i=!1;const r=setTimeout(()=>{i||(i=!0,s(new Error("Turnstile widget timeout")))},1e4);try{const h=document.createElement("div");h.style.position="absolute",h.style.left="-9999px",document.body.appendChild(h);const t=document.createElement("div");h.appendChild(t);const a=window.turnstile.render(t,{sitekey:d,size:"compact",callback:c=>{if(!i){i=!0,clearTimeout(r);try{document.body.removeChild(h)}catch{}l(c)}}});setTimeout(()=>{try{try{console.debug("turnstile.execute -> widgetId:",a,"type:",typeof a)}catch{}if(window.turnstile&&typeof window.turnstile.reset=="function")try{window.turnstile.reset(a)}catch{}window.turnstile.execute(a)}catch(c){if(!i){i=!0,clearTimeout(r);try{document.body.removeChild(h)}catch{}s(c)}}},50)}catch(h){s(h)}})),m=()=>n.map(({product:d,quantity:l})=>{const s=Number(d.price),i=Number(d.discount_perc)||0,r=d.discount_end_date?new Date(d.discount_end_date):null,h=new Date,a=i>0&&(!r||h<=r)&&!isNaN(s)?Number((s*(1-i)).toFixed(2)):s;return{product:{...d,price:a},quantity:l}}),g=n.reduce((d,l)=>d+(l.product.weight||0)*l.quantity,0),o=v(n),b=async()=>{if(g>100){window.confirm("Heavy Items. Freight quote will be needed. Proceeding to page.")&&f("/freight-inquiry",{state:{cart:n}});return}if(u)return;const d="0x4AAAAAAB-d-eg5_99Hui2g";let l=null;try{l=await y(d)}catch(r){console.warn("Turnstile error",r)}if(!l){window.alert("Captcha failed — please try again.");return}const s=await fetch("/.netlify/functions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:m(),shippingCost:o.cost,captchaToken:l})});if(!s.ok){const r=await s.json().catch(()=>({error:"Unknown error"}));window.alert(r.error||"Checkout failed");return}const{url:i}=await s.json();window.location=i};return e.jsx("button",{className:"btn brand",style:{fontWeight:700,fontSize:"1.1rem",borderRadius:8,padding:"0.7rem 2rem",marginLeft:"1rem",opacity:u?.5:1,pointerEvents:u?"none":"auto"},onClick:b,disabled:u,children:"Checkout"})}function v(n){const u=n.reduce((g,o)=>g+(o.product.weight||0)*o.quantity,0),f=Math.max(...n.map(g=>Math.max(g.product.length_mm||0,g.product.width_mm||0,g.product.height_mm||0))),y=n.reduce((g,o)=>g+Number(o.product.price)*o.quantity,0);let m=0;return u<=2?m=10:u<=10?m=20:u<=25?m=35:u<=50?m=60:m=150,f>48?{type:"freight",cost:150}:(f>36?m+=25:f>24&&(m+=10),y>2e3&&(m=0),{type:"ground",cost:m})}function q(){const{cart:n,dispatch:u}=C(),f=T(),y=n.items.reduce((t,a)=>{const c=Number(a.product.price),p=Number(a.product.discount_perc)||0,x=a.product.discount_end_date?new Date(a.product.discount_end_date):null,w=new Date,j=p>0&&(!x||w<=x)&&!isNaN(c)?c*(1-p):c;return t+j*a.quantity},0),[m,g]=S.useState({name:"",street1:"",city:"",state:"",zip:"",country:"US"});n.items.some(t=>t.quantity>Number(t.product.inventory??0)),n.items.filter(t=>Number(t.product.inventory??0)>0&&t.quantity>=Number(t.product.inventory??0));const[o,b]=S.useState(()=>v(n.items));A.useEffect(()=>{b(v(n.items))},[n.items]);const d=n.items.reduce((t,a)=>t+(a.product.weight||0)*a.quantity,0),l=y,s=o&&o.type!=="freight"?Number(o.cost||0):0,i=(o==null?void 0:o.type)==="freight"||d>100,r=0,h=l+(i?0:s)+r;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{minHeight:"80vh",padding:"2rem",background:"var(--bg)",boxSizing:"border-box"},children:[e.jsx("h2",{className:"distressed gallery-title",style:{textAlign:"center",marginBottom:"2rem",marginTop:"7rem",color:"#222",textShadow:"0 1px 4px #fff, 0 0px 1px #bbb",fontSize:"2rem",wordBreak:"break-word"},children:"Shopping Cart"}),n.items.length===0?e.jsx("div",{style:{textAlign:"center",color:"#444",fontSize:"1.2rem",fontWeight:500},children:"Your cart is empty."}):e.jsxs("div",{className:"cart-page-content",style:{maxWidth:800,margin:"0 auto",background:"#fff",borderRadius:16,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222",boxSizing:"border-box",width:"100%"},children:[e.jsx("div",{className:"cart-cards",style:{display:"flex",flexDirection:"column",gap:"1rem"},children:n.items.map(({product:t,quantity:a})=>e.jsxs("div",{className:"cart-card",style:{display:"flex",flexDirection:"column",background:"#f8f8f8",borderRadius:12,padding:"1rem",boxShadow:"0 1px 4px #eee",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[t.image&&e.jsx(e.Fragment,{children:e.jsx("img",{src:N(t.image),alt:t.name,style:{width:60,height:60,objectFit:"cover",borderRadius:8,boxShadow:"0 1px 4px #ccc"},loading:"lazy",onError:c=>{console.log("Image error:",t.image,N(t.image)),c.currentTarget.src="/logo.png"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{className:"cart-product-name",style:{fontWeight:700,fontSize:"1.05rem",display:"block",marginBottom:2},children:t.name.length>100?t.name.slice(0,100)+"…":t.name}),t.sku&&e.jsxs("span",{className:"cart-product-sku",style:{fontSize:"0.95rem",color:"#666",display:"block",marginBottom:2},children:["SKU: ",t.sku]}),e.jsxs("span",{className:"cart-product-weight",style:{fontSize:"0.95rem",color:"#388e3c",display:"block",marginTop:2},children:["Weight: ",t.weight?t.weight+" lbs":"N/A"]})]}),e.jsx("div",{style:{textAlign:"right",minWidth:90,fontWeight:700,fontSize:"1.05rem"},children:(()=>{const c=Number(t.price),p=Number(t.discount_perc)||0,x=t.discount_end_date?new Date(t.discount_end_date):null,w=new Date;if(p>0&&(!x||w<=x)&&!isNaN(c)){const j=(c*(1-p)).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{textDecoration:"line-through",color:"#888",marginRight:8},children:["$",c.toFixed(2)]}),e.jsxs("span",{style:{color:"#d32f2f",fontWeight:700},children:["$",j]})]})}else return isNaN(c)?"Price N/A":`$${c.toFixed(2)}`})()})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:12,marginTop:8},children:[e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>{u({type:"SUBTRACT_FROM_CART",product:t})},"aria-label":"Decrease quantity",children:"-"}),e.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1.1rem"},children:a}),e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>{u({type:"ADD_TO_CART",product:t})},"aria-label":"Increase quantity",children:"+"})]})]},t.id))}),e.jsxs("div",{className:"cart-summary",style:{textAlign:"right",marginTop:"2rem"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"1.2rem",wordBreak:"break-word"},children:["Subtotal: $",l.toFixed(2)]}),e.jsxs("div",{style:{fontWeight:500,fontSize:"1.05rem",color:"#555",marginTop:"0.5rem"},children:["Total Weight: ",d.toFixed(2)," lbs"]}),e.jsxs("div",{style:{fontWeight:500,fontSize:"1.05rem",color:"#555",marginTop:"0.5rem"},children:["Shipping: ",i?"Need to Quote (Freight)":`$${s.toFixed(2)}`]}),e.jsxs("div",{style:{fontWeight:500,fontSize:"1.05rem",color:"#555",marginTop:"0.5rem"},children:["Tax: $",r.toFixed(2)]}),e.jsxs("div",{style:{fontWeight:800,fontSize:"1.25rem",color:"#222",marginTop:"0.75rem"},children:["Total: $",h.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"right",marginTop:"1rem",display:"flex",flexWrap:"wrap",gap:12,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn btn-lg danger",style:{fontWeight:700,minWidth:120},onClick:()=>{u({type:"CLEAR_CART"})},children:"Clear Cart"}),(o==null?void 0:o.type)==="freight"||d>100?e.jsx("button",{className:"btn btn-lg neutral freight",style:{fontWeight:700,minWidth:180,cursor:"pointer"},onClick:()=>f("/freight-inquiry",{state:{cart:n}}),children:"Get Freight Quote"}):e.jsx(z,{cart:n.items,disabled:!1})]})]})]}),e.jsx(_,{})]})}export{q as default};
