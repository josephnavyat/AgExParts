import{u as C,c as v,b as T,j as t}from"./index-DySAaLdo.js";import{N as k}from"./Navbar-tn3pnaly.js";import{F}from"./Footer-BPL0sqLk.js";function N(){const{cart:u,shippingCost:f}=C();v(),T();const x=u.reduce((r,s)=>r+s.product.price*s.quantity,0),h=f||0,w=x+Number(h),g=async()=>{const r="0x4AAAAAAB-d-eg5_99Hui2g",s=async c=>(window.turnstile||await new Promise((a,o)=>{const e=document.querySelector('script[src*="challenges.cloudflare.com/turnstile"]');if(e){e.addEventListener("load",a),e.addEventListener("error",o);return}const n=document.createElement("script");n.src="https://challenges.cloudflare.com/turnstile/v0/api.js",n.async=!0,n.onload=a,n.onerror=o,document.head.appendChild(n)}),await new Promise((a,o)=>{let e=!1;const n=setTimeout(()=>{e||(e=!0,o(new Error("Turnstile widget timeout")))},1e4);try{const i=document.createElement("div");i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i);const y=document.createElement("div");i.appendChild(y);const l=window.turnstile.render(y,{sitekey:c,size:"compact",callback:d=>{if(!e){e=!0,clearTimeout(n);try{document.body.removeChild(i)}catch{}a(d)}}});setTimeout(()=>{try{try{console.debug("turnstile.execute -> widgetId:",l,"type:",typeof l)}catch{}if(window.turnstile&&typeof window.turnstile.reset=="function")try{window.turnstile.reset(l)}catch{}window.turnstile.execute(l)}catch(d){if(!e){e=!0,clearTimeout(n);try{document.body.removeChild(i)}catch{}o(d)}}},50)}catch(i){o(i)}}));let m=null;try{m=await s(r)}catch(c){console.warn("Turnstile error",c)}if(!m){window.alert("Captcha failed â€” please try again.");return}const p=await fetch("/.netlify/functions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:u,shippingCost:h,captchaToken:m})});if(!p.ok){const c=await p.json().catch(()=>({error:"Unknown error"}));window.alert(c.error||"Checkout failed");return}const{url:j}=await p.json();window.location=j};return t.jsxs(t.Fragment,{children:[t.jsx(k,{}),t.jsxs("div",{className:"container",style:{maxWidth:700,margin:"2rem auto",padding:24,background:"#fff",borderRadius:8},children:[t.jsx("h2",{children:"Freight Order Confirmation"}),t.jsxs("table",{style:{width:"100%",marginBottom:24},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Product"}),t.jsx("th",{children:"Quantity"}),t.jsx("th",{children:"Unit Price"}),t.jsx("th",{children:"Subtotal"})]})}),t.jsx("tbody",{children:u.map((r,s)=>t.jsxs("tr",{children:[t.jsx("td",{children:r.product.name}),t.jsx("td",{children:r.quantity}),t.jsxs("td",{children:["$",r.product.price]}),t.jsxs("td",{children:["$",(r.product.price*r.quantity).toFixed(2)]})]},s))})]}),t.jsxs("div",{style:{textAlign:"right",marginBottom:12},children:[t.jsxs("div",{children:["Subtotal: ",t.jsxs("strong",{children:["$",x.toFixed(2)]})]}),t.jsxs("div",{children:["Freight Cost: ",t.jsxs("strong",{children:["$",h]})]}),t.jsxs("div",{style:{fontSize:18,marginTop:8},children:["Total: ",t.jsxs("strong",{children:["$",w.toFixed(2)]})]})]}),t.jsx("button",{className:"btn primary",style:{fontWeight:700,fontSize:"1.1rem",borderRadius:8,padding:"0.7rem 2rem"},onClick:g,children:"Proceed to Payment"})]}),t.jsx(F,{})]})}export{N as default};
