import{c as ee,r as l,u as te,j as t,L as se,g as re}from"./index-PZtE8jMc.js";import{N as ae}from"./Navbar-BThQrc94.js";/* empty css                       */import{g as le}from"./imageUrl-BC-b4leq.js";function ue(){const x=ee(),c=new URLSearchParams(x.search),$=c.get("q")||"",k=c.get("category")||"",w=c.get("subcategory")||"";c.get("manufacturer"),c.get("machine_type"),c.get("model");const[P,j]=l.useState([]),[i,H]=l.useState({manufacturers:[],machine_types:[],models:[]}),[b,o]=l.useState(null),[B,Q]=l.useState(!0),[_,G]=l.useState(null),[u,L]=l.useState(!1),[h,T]=l.useState($),[m,R]=l.useState(""),[g,M]=l.useState(""),[d,E]=l.useState(""),[v,J]=l.useState(""),[q,K]=l.useState(!1),[y,V]=l.useState(24),[f,p]=l.useState(1),{dispatch:N,cart:X}=te();l.useEffect(()=>{const e=new AbortController;return(async()=>{try{const a=await fetch("/.netlify/functions/get-data",{signal:e.signal});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();Array.isArray(s)?j(s):s&&Array.isArray(s.products)?j(s.products):j([])}catch(a){a.name!=="AbortError"&&G(a.message)}finally{Q(!1)}})(),(async()=>{try{const a=await fetch("/.netlify/functions/get-compatibility-options");if(!a.ok)return;const s=await a.json();s&&H({manufacturers:s.manufacturers||[],machine_types:s.machine_types||[],models:s.models||[]})}catch{}})(),()=>e.abort()},[]),l.useEffect(()=>{const e=new URLSearchParams(x.search),r=e.get("manufacturer")||"",a=e.get("machine_type")||"",s=e.get("model")||"";R(r),M(a),E(s),p(1);const n=e.get("q")||"";T(n)},[x.search]),l.useEffect(()=>{const e=new AbortController,r=m||"",a=g||"",s=d||"";return!r&&!a&&!s?(o(null),()=>e.abort()):((async()=>{try{const n=new URLSearchParams;r&&n.append("manufacturer",r),a&&n.append("machine_type",a),s&&n.append("model",s);const Y="/.netlify/functions/get-compatible-skus?"+n.toString(),W=await fetch(Y,{signal:e.signal});if(!W.ok){o(null);return}const C=await W.json();C&&Array.isArray(C.skus)?o(C.skus.map(Z=>String(Z||"").trim().toLowerCase())):o([])}catch(n){n.name!=="AbortError"&&o(null)}})(),()=>e.abort())},[m,g,d]);const I=e=>le(e),S=e=>{const r=new Map;for(const a of P){if(!a)continue;let s=a[e];if(s==null||(typeof s=="string"?s=s.trim():s=String(s).trim(),!s))continue;const n=s.toLowerCase();r.has(n)||r.set(n,s)}return Array.from(r.values()).sort((a,s)=>a.localeCompare(s))},A=e=>{if(!e)return null;if(typeof e.image=="string"&&e.image.trim())return e.image.trim();if(Array.isArray(e.images)&&e.images.length&&typeof e.images[0]=="string")return e.images[0];if(Array.isArray(e.gallery)&&e.gallery.length&&typeof e.gallery[0]=="string")return e.gallery[0];if(Array.isArray(e.photos)&&e.photos.length&&typeof e.photos[0]=="string")return e.photos[0];const r=["images","gallery","photos"];for(const a of r)if(Array.isArray(e[a])&&e[a].length){const s=e[a][0];if(s&&typeof s=="object"){if(s.src)return s.src;if(s.url)return s.url}}return null},O=P.filter(e=>!k||e.category&&String(e.category)===String(k)).filter(e=>!w||e.subcategory&&String(e.subcategory)===String(w)).filter(e=>e.website_visible===!0).filter(e=>{if(Array.isArray(b)){if(b.length===0)return!1;const r=e.sku||e.part_number||e.id;return r==null?!1:b.includes(String(r).trim().toLowerCase())}return!(m&&e.manufacturer!==m||g&&e.machine_type!==g||d&&e.model!==d)}).filter(e=>!q||Number(e.inventory??e.quantity??0)>0).filter(e=>{if(h&&h.trim()){const r=h.toLowerCase();return e.name&&e.name.toLowerCase().includes(r)||e.part_number&&String(e.part_number).toLowerCase().includes(r)||e.sku&&String(e.sku).toLowerCase().includes(r)}return!0}).sort((e,r)=>v==="price-asc"?(e.price||0)-(r.price||0):v==="price-desc"?(r.price||0)-(e.price||0):0),D=O.length,F=(f-1)*y,z=F+y,U=O.slice(F,z);return t.jsxs("div",{className:"simple-gallery-root",children:[t.jsx(ae,{}),t.jsxs("div",{className:"simple-gallery-header",children:[t.jsx("h2",{className:"simple-gallery-title",children:"Search Results"}),t.jsxs("div",{className:"simple-gallery-perpage",children:[t.jsx("label",{className:"filter-label",htmlFor:"perPageSelect",children:"Show:"}),t.jsx("select",{id:"perPageSelect",className:"filter-select",value:y,onChange:e=>{V(Number(e.target.value)),p(1)},children:[24,48,72,96].map(e=>t.jsxs("option",{value:e,children:[e," per page"]},e))})]}),t.jsx("button",{className:"simple-gallery-filter-toggle","aria-label":u?"Hide Filters":"Show Filters","aria-pressed":u,"aria-controls":"gallery-filter-pane",onClick:()=>L(e=>!e),children:"Filter"})]}),t.jsx("hr",{className:"simple-gallery-divider"}),t.jsxs("div",{className:"simple-gallery-layout",children:[t.jsxs("aside",{id:"gallery-filter-pane",className:`simple-gallery-filter-pane${u?"":" simple-gallery-filter-pane--closed"}`,"aria-hidden":!u,children:[t.jsxs("div",{className:"simple-gallery-filter-header",onClick:()=>L(e=>!e),children:["Filters ",u?"▼":"▶"]}),t.jsxs("div",{className:"simple-gallery-filter-content",children:[t.jsx("input",{type:"text",className:"search-input",placeholder:"Search...",value:h,onChange:e=>T(e.target.value)}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Manufacturer"}),t.jsxs("select",{value:m,onChange:e=>R(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Manufacturers"}),(i.manufacturers&&i.manufacturers.length>0?i.manufacturers:S("manufacturer")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Machine Type"}),t.jsxs("select",{value:g,onChange:e=>M(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Machine Types"}),(i.machine_types&&i.machine_types.length>0?i.machine_types:S("machine_type")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Model"}),t.jsxs("select",{value:d,onChange:e=>E(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Models"}),(i.models&&i.models.length>0?i.models:S("model")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Sort by"}),t.jsxs("select",{value:v,onChange:e=>J(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"None"}),t.jsx("option",{value:"price-asc",children:"Price: Low to High"}),t.jsx("option",{value:"price-desc",children:"Price: High to Low"})]})]}),t.jsx("div",{className:"filter-section",children:t.jsxs("label",{className:"filter-label",children:[t.jsx("input",{type:"checkbox",checked:q,onChange:e=>K(e.target.checked)})," In-stock only"]})})]})]}),t.jsxs("div",{className:"simple-gallery-grid",style:{marginLeft:0},children:[B?t.jsx("div",{children:"Loading..."}):_?t.jsxs("div",{children:["Error: ",_]}):U.length===0?t.jsx("div",{children:"No results found."}):U.map(e=>t.jsxs(se,{to:`/product/${e.id}`,className:"simple-gallery-card",style:{textDecoration:"none"},children:[t.jsx("div",{className:"simple-gallery-image-wrapper",children:t.jsx("img",{src:I(A(e)||e.image),alt:e.name,loading:"lazy",onError:r=>{console.log("Image error:",A(e)||e.image,I(A(e)||e.image)),r.currentTarget.src="/logo.png"}})}),e.sku&&t.jsx("div",{className:"simple-gallery-sku",children:e.sku}),t.jsx("h3",{className:"simple-gallery-card-title",title:e.name,children:e.name}),t.jsx("div",{className:"simple-gallery-part-number",children:e.part_number}),t.jsx("div",{className:"simple-gallery-card-price",children:(()=>{const r=Number(e.price);return isNaN(r)?t.jsx("span",{className:"price-current",children:"Price N/A"}):t.jsxs("span",{className:"price-current",children:["$",r.toFixed(2)]})})()}),t.jsx("div",{className:"simple-gallery-card-actions",role:"group","aria-label":"Product Actions",children:(()=>{const r=re(X,e.id),a=Number(e.inventory??e.quantity??0);return r>0?t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#f6f6f6",borderRadius:8,padding:"0.2rem 0.5rem"},children:[t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:s=>{s.stopPropagation(),s.preventDefault(),N({type:"SUBTRACT_FROM_CART",product:e})},"aria-label":"Decrease quantity",children:"-"}),t.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1rem"},children:r}),t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:s=>{s.stopPropagation(),s.preventDefault(),N({type:"ADD_TO_CART",product:e})},"aria-label":"Increase quantity",disabled:r>=a,children:"+"})]}):t.jsx("button",{className:"simple-gallery-btn primary",onClick:s=>{s.stopPropagation(),s.preventDefault(),N({type:"ADD_TO_CART",product:e})},title:"Add to Cart","aria-label":a===0?"Out of Stock":"Add to Cart",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:a===0?.5:1,pointerEvents:a===0?"none":"auto",position:"relative"},disabled:a===0,children:t.jsx("span",{className:"add-to-cart-label",style:{fontWeight:800,fontSize:"0.98rem"},children:"Add to Cart"})})})()})]},e.id)),t.jsx("div",{className:"simple-gallery-pagination",children:t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",margin:"2rem auto 0 auto",gap:12,width:"100%"},children:[f>1&&t.jsx("button",{className:"simple-gallery-btn secondary",onClick:()=>p(f-1),children:"< Prev"}),t.jsxs("span",{style:{color:"#c3c3c3",fontWeight:500,fontSize:"1.05rem",margin:"0 1rem"},children:["Page ",f," of ",Math.max(1,Math.ceil(D/y))]}),z<D&&t.jsx("button",{className:"simple-gallery-btn secondary",onClick:()=>p(f+1),children:"Next >"})]})})]})]})]})}export{ue as default};
