import{r,u as ne,c as ae,b as re,j as t,L as w}from"./index-gi7GTMaL.js";import{g as oe}from"./imageUrl-CI4-tccc.js";function xe(){const[C,$]=r.useState(!1),[I,D]=r.useState(!1),[M,F]=r.useState(""),[N,H]=r.useState(null),[A,B]=r.useState([]),[U,L]=r.useState(!1),R=r.useRef(null);r.useEffect(()=>{const e=()=>$(window.scrollY>80);return document.addEventListener("scroll",e),e(),()=>document.removeEventListener("scroll",e)},[]),r.useEffect(()=>{try{C?document.body.classList.add("nav-collapsed"):document.body.classList.remove("nav-collapsed")}catch{}},[C]);const{cart:K}=ne(),W=K.items.reduce((e,s)=>e+s.quantity,0),[O,k]=r.useState(!1),Y=r.useRef(null),G=r.useRef(null),J=ae(),_=re(),[ce,le]=r.useState([]),[ie,P]=r.useState(!1),[de,ue]=r.useState(!1),[me,fe]=r.useState(!1),[he,pe]=r.useState(""),[T,z]=r.useState([]),[h,Q]=r.useState({}),[y,x]=r.useState([]),[v,V]=r.useState([]),[m,X]=r.useState([]),[u,Z]=r.useState(""),[p,b]=r.useState(""),[E,S]=r.useState(""),[q,ee]=r.useState(!1),te=async()=>{try{try{const i=await fetch("/.netlify/functions/get-compatibility-options");if(i&&i.ok){const c=await i.json();c&&(Array.isArray(c.manufacturers)&&z(c.manufacturers.slice().sort((o,d)=>o.localeCompare(d))),Array.isArray(c.machine_types)&&V(c.machine_types.slice().sort((o,d)=>o.localeCompare(d))),Array.isArray(c.models)&&x(c.models.slice().sort((o,d)=>o.localeCompare(d))))}}catch{}const e=await fetch("/.netlify/functions/get-data");if(!e.ok)throw new Error("fetch failed");const s=await e.json();let n=Array.isArray(s)?s:s&&Array.isArray(s.products)?s.products:[];console.info("Navbar: fetched products for manufacturers",{rawType:typeof s,productsLength:Array.isArray(n)?n.length:0,sampleKeys:n&&n[0]?Object.keys(n[0]).slice(0,12):null}),X(n);const a=(i,...c)=>{for(const o of c){if(!i)continue;const d=i[o];if(d!=null)return d}};try{const i=Array.from(new Set(n.map(o=>String(a(o,"machine_type","machineType","machine")||"").trim()).filter(Boolean))).sort((o,d)=>o.localeCompare(d)),c=Array.from(new Set(n.map(o=>String(a(o,"model","models")||"").trim()).filter(Boolean))).sort((o,d)=>o.localeCompare(d));(!v||v.length===0)&&i.length&&V(i),(!y||y.length===0)&&c.length&&x(c)}catch{}const l=new Map;for(const i of n){const c=String(a(i,"manufacturer","manufacturer_name","make")||"").trim(),o=String(a(i,"machine_type","machineType","machine")||"").trim(),d=String(a(i,"model","models","model_number")||"").trim();if(!c)continue;l.has(c)||l.set(c,new Map);const j=l.get(c);o&&(j.has(o)||j.set(o,new Set),d&&j.get(o).add(d))}const g=Array.from(l.keys()).sort((i,c)=>i.localeCompare(c));g.length&&z(g);const f={};for(const[i,c]of l.entries()){f[i]={};for(const[o,d]of c.entries())f[i][o]=Array.from(d).sort((j,se)=>j.localeCompare(se))}if(Q(f),!y||y.length===0){const i=new Set;for(const c of Object.values(f))for(const o of Object.values(c))for(const d of o)i.add(d);i.size>0&&x(Array.from(i).sort((c,o)=>c.localeCompare(o)))}console.info("Navbar: loadManufacturers complete",{manufacturersCount:(T||[]).length,compatMachineTypesCount:(v||[]).length,nestedManufacturerCount:Object.keys(f||{}).length,modelsCount:(y||[]).length})}catch(e){console.error("Failed to load manufacturers",e)}};return r.useEffect(()=>{try{if(!u){x([]),b("");return}const e=h[u]||{};b("");const s=new Set;if(Object.keys(e).length>0)for(const n of Object.values(e))for(const a of n)s.add(a);else if(m&&m.length>0){const n=(a,...l)=>{for(const g of l){if(!a)continue;const f=a[g];if(f!=null)return f}};for(const a of m)if(String(n(a,"manufacturer","manufacturer_name","make")||"").trim()===(u||"").trim()){const g=String(n(a,"model","models","model_number")||"").trim();g&&s.add(g)}}x(Array.from(s).sort((n,a)=>n.localeCompare(a))),console.info("Navbar: selManufacturer changed",{selManufacturer:u,modelsCount:(Array.from(s)||[]).length,nestedForManufacturer:Object.keys(e||{}).length})}catch{}},[u,h]),r.useEffect(()=>{try{if(!p){x([]),S("");return}let e=[];if(u)e=(h[u]||{})[p]||[];else{const s=new Set;for(const n of Object.keys(h||{})){const a=(h[n]||{})[p]||[];for(const l of a)s.add(l)}if(s.size===0&&m&&m.length>0){for(const n of m)if((n.machine_type||n.machineType||"").trim()===p){const l=(n.model||"").trim();l&&s.add(l)}}e=Array.from(s).sort((n,a)=>n.localeCompare(a))}x(e),S(""),console.info("Navbar: selMachineType changed",{selManufacturer:u,selMachineType:p,modelsForSelection:e.length})}catch{x([])}},[p,u,h]),r.useEffect(()=>{try{return document.body.classList.add("has-secondary-nav"),()=>document.body.classList.remove("has-secondary-nav")}catch{}},[]),r.useEffect(()=>{k(!1)},[J.pathname]),r.useEffect(()=>{if(!O)return;const e=s=>{var n;if(s.key==="Escape"){k(!1);try{(n=G.current)==null||n.focus()}catch{}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[O]),t.jsx(t.Fragment,{children:t.jsxs("nav",{id:"nav",className:`nav ${C?"scrolled":""}${I?" nav--search-open":""}`,children:[t.jsxs("div",{className:"container nav-inner",style:{flexWrap:"wrap",alignItems:"center"},children:[t.jsxs("div",{className:"brand",children:[t.jsx("img",{src:"/logo.png",alt:"AgEx Parts logo",style:{height:"80px",width:"auto"}}),t.jsx("h1",{className:"distressed",style:{color:"dark grey"},children:"For your ideal PART"})]}),t.jsxs("div",{className:"nav-cta",style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[t.jsx(w,{to:"/",className:"nav-icon","aria-label":"Home",title:"Home",children:t.jsxs("svg",{className:"nav-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M3 9.5L12 3l9 6.5V21a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9.5z"}),t.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),t.jsx(w,{to:"/profile",className:"nav-icon","aria-label":"Profile",title:"Profile",children:t.jsxs("svg",{className:"nav-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"12",cy:"8",r:"4"}),t.jsx("path",{d:"M6 20v-2a6 6 0 0 1 12 0v2"})]})}),t.jsx("button",{className:"nav-icon",onClick:()=>D(e=>!e),title:"Search","aria-label":"Search",children:t.jsxs("svg",{className:"nav-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),t.jsxs(w,{to:"/cart",className:"nav-icon","aria-label":"Cart",title:"Cart",style:{position:"relative"},children:[t.jsxs("svg",{className:"nav-svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"9",cy:"21",r:"1.5"}),t.jsx("circle",{cx:"19",cy:"21",r:"1.5"}),t.jsx("path",{d:"M1 1h2l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6",fill:"none"})]}),W>0&&t.jsx("span",{style:{position:"absolute",top:"-6px",right:"-6px",background:"#19a974",color:"#fff",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,padding:"2px 6px",minWidth:18,textAlign:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.13)"},children:W})]})]})]}),I&&t.jsx("div",{className:"search-bar-collapsible",style:{width:"100%",background:"rgba(30,30,30,0.55)",boxShadow:"0 2px 12px rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 0",position:"static",zIndex:39},children:t.jsxs("form",{style:{display:"flex",alignItems:"center",gap:8,width:"100%",maxWidth:400},onSubmit:e=>{e.preventDefault(),M.trim()&&(window.location.href=`/search-results?q=${encodeURIComponent(M.trim())}`)},children:[t.jsx("input",{id:"nav-search-input",type:"text",placeholder:"Search for parts...",value:M,onChange:e=>{const s=e.target.value;if(F(s),clearTimeout(R.current),!s||s.trim().length<2){B([]),L(!1);return}R.current=setTimeout(()=>{const n=s.trim().toLowerCase();if(!N)return;const a=N.filter(l=>{const g=(l.name||"").toLowerCase(),f=(l.sku||"").toLowerCase();return g.includes(n)||f.includes(n)}).slice(0,6);B(a),L(a.length>0)},180)},style:{padding:"0.75rem 1rem",fontSize:"1.1rem",borderRadius:"8px",border:"1px solid #ccc",width:"100%",minWidth:0,boxShadow:"0 1px 4px rgba(0,0,0,0.07)",flex:1},onFocus:async()=>{if(!N)try{const s=await(await fetch("/.netlify/functions/get-data")).json();let n=Array.isArray(s)?s:s&&Array.isArray(s.products)?s.products:[];n=n.map(a=>({id:a.id,name:a.name,image:a.image,sku:a.sku||a.part_number||""})),H(n)}catch{}},onBlur:()=>setTimeout(()=>L(!1),150)}),U&&A&&A.length>0&&t.jsx("div",{className:"nav-search-suggestions",role:"listbox",children:A.map(e=>t.jsxs("button",{className:"nav-suggestion-item",onMouseDown:s=>{s.preventDefault();const n=e.sku&&String(e.sku).trim()?e.sku:e.name;window.location.href=`/search-results?q=${encodeURIComponent(n)}`},children:[e.image?t.jsx("img",{src:oe(e.image),alt:"",className:"nav-suggestion-thumb"}):t.jsx("span",{className:"nav-suggestion-thumb empty"}),t.jsxs("span",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[t.jsx("span",{className:"nav-suggestion-text",children:e.name}),e.sku&&t.jsx("small",{style:{color:"#666",marginTop:4},children:e.sku})]})]},e.id))}),t.jsxs("button",{type:"submit",style:{background:"#19a974",color:"#fff",border:"none",borderRadius:"8px",padding:"0.75rem 1.5rem",fontSize:"1.1rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:6},title:"Search",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),"Enter"]})]})}),t.jsx("div",{className:`nav-secondary ${O?"open":""}`,ref:Y,children:t.jsx("div",{className:"container",children:t.jsxs("nav",{id:"secondary-links","aria-label":"Browse links",children:[t.jsx("div",{className:"nav-categories-wrapper",children:t.jsx(w,{to:"/categories",className:"nav-secondary-link nav-categories-toggle",onClick:e=>{e.preventDefault();try{try{k(!1)}catch{}try{P(!1)}catch{}_("/categories"),requestAnimationFrame(()=>setTimeout(()=>{try{const s=document.querySelector(".main-content > h2");if(s&&s.scrollIntoView){console.info("Navbar: scrolling to category heading via scrollIntoView"),s.scrollIntoView({block:"start"});return}const n=document.querySelector(".nav"),a=n?Math.ceil(n.getBoundingClientRect().height):140;console.info("Navbar: falling back to scrollBy",a),window.scrollBy(0,-a+6)}catch{}},400))}catch{window.location.href="/categories"}},children:"Browse by Category"})}),t.jsxs("div",{className:"nav-manufacturers-wrapper",style:{position:"relative"},children:[t.jsx("a",{href:"/machines",className:"nav-secondary-link nav-manufacturers-toggle",onClick:async e=>{e.preventDefault(),k(!0),(T.length===0||Object.keys(h||{}).length===0)&&await te(),P(!1),ee(s=>!s)},children:"Browse by Machine"}),t.jsxs("div",{className:`nav-manufacturer-inline${q?" open":""}`,style:{position:"absolute",left:0,top:"100%",zIndex:45,minWidth:360,display:q?"block":"none"},children:[t.jsx("div",{className:"simple-gallery-filter-header",style:{padding:"10px 12px 6px"},children:"Browse Machines"}),t.jsxs("div",{className:"nav-manufacturer-row",style:{padding:"12px"},children:[t.jsxs("select",{className:"filter-select",value:u,onChange:e=>{const s=e.target.value;Z(s),b(""),S("")},children:[t.jsx("option",{value:"",children:"All Manufacturers"}),T.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{className:"filter-select",value:p,onChange:e=>{const s=e.target.value;b(s)},children:[t.jsx("option",{value:"",children:"All Machine Types"}),(()=>{if(!u)return v&&v.length?v:Object.keys(h||{}).flatMap(n=>Object.keys(h[n]||{})).filter((n,a,l)=>l.indexOf(n)===a).sort((n,a)=>n.localeCompare(a));const e=h[u]||{},s=Object.keys(e||{}).sort((n,a)=>n.localeCompare(a));if(s.length)return s;if(m&&m.length){const n=new Set;for(const a of m)try{if((a.manufacturer||"").trim()===(u||"").trim()){const l=(a.machine_type||a.machineType||"").toString().trim();l&&n.add(l)}}catch{}return Array.from(n).sort((a,l)=>a.localeCompare(l))}return[]})().map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{className:"filter-select",value:E,onChange:e=>S(e.target.value),children:[t.jsx("option",{value:"",children:"All Models"}),(y||[]).map(e=>t.jsx("option",{value:e,children:e},e)),!(y&&y.length)&&u&&m&&m.length&&(()=>{const e=new Set;for(const s of m)try{if((s.manufacturer||"").trim()===(u||"").trim()){const n=(s.model||"").toString().trim();n&&e.add(n)}}catch{}return Array.from(e).sort((s,n)=>s.localeCompare(n)).map(s=>t.jsx("option",{value:s,children:s},`fb-${s}`))})()]}),t.jsxs("a",{className:"nav-secondary-link nav-manufacturer-search",style:{display:"inline-flex",alignItems:"center",gap:8,padding:"10px 14px",borderRadius:8},onClick:()=>{const e=new URLSearchParams;u&&e.set("manufacturer",u),p&&e.set("machine_type",p),E&&e.set("model",E);const s=`/search-results?${e.toString()}`;_(s)},children:[t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 21l-4.35-4.35"}),t.jsx("path",{d:"M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"})]}),t.jsx("span",{children:"Search"})]})]})]})]}),t.jsx(w,{to:"/about",className:"nav-secondary-link",children:"About Us"})]})})})]})})}export{xe as N};
