import{c as te,r as l,u as se,j as t,L as re,g as ae}from"./index-gi7GTMaL.js";import{N as le}from"./Navbar-BEaLdVHS.js";/* empty css                       */import{g as ie}from"./imageUrl-CI4-tccc.js";import{L as ne}from"./LimitTooltip-BWWIkD2v.js";function de(){const j=te(),c=new URLSearchParams(j.search),H=c.get("q")||"",w=c.get("category")||"",P=c.get("subcategory")||"";c.get("manufacturer"),c.get("machine_type"),c.get("model");const[_,b]=l.useState([]),[n,B]=l.useState({manufacturers:[],machine_types:[],models:[]}),[v,o]=l.useState(null),[Q,G]=l.useState(!0),[L,J]=l.useState(null),[m,T]=l.useState(!1),[y,M]=l.useState(H),[u,R]=l.useState(""),[g,q]=l.useState(""),[f,E]=l.useState(""),[N,K]=l.useState(""),[I,V]=l.useState(!1),[p,X]=l.useState(24),[d,x]=l.useState(1),{dispatch:S,cart:Y,limitMap:ce,showLimit:Z}=se();l.useEffect(()=>{const e=new AbortController;return(async()=>{try{const a=await fetch("/.netlify/functions/get-data",{signal:e.signal});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();Array.isArray(s)?b(s):s&&Array.isArray(s.products)?b(s.products):b([])}catch(a){a.name!=="AbortError"&&J(a.message)}finally{G(!1)}})(),(async()=>{try{const a=await fetch("/.netlify/functions/get-compatibility-options");if(!a.ok)return;const s=await a.json();s&&B({manufacturers:s.manufacturers||[],machine_types:s.machine_types||[],models:s.models||[]})}catch{}})(),()=>e.abort()},[]),l.useEffect(()=>{const e=new URLSearchParams(j.search),r=e.get("manufacturer")||"",a=e.get("machine_type")||"",s=e.get("model")||"";R(r),q(a),E(s),x(1);const i=e.get("q")||"";M(i)},[j.search]),l.useEffect(()=>{const e=new AbortController,r=u||"",a=g||"",s=f||"";return!r&&!a&&!s?(o(null),()=>e.abort()):((async()=>{try{const i=new URLSearchParams;r&&i.append("manufacturer",r),a&&i.append("machine_type",a),s&&i.append("model",s);const h="/.netlify/functions/get-compatible-skus?"+i.toString(),$=await fetch(h,{signal:e.signal});if(!$.ok){o(null);return}const k=await $.json();k&&Array.isArray(k.skus)?o(k.skus.map(ee=>String(ee||"").trim().toLowerCase())):o([])}catch(i){i.name!=="AbortError"&&o(null)}})(),()=>e.abort())},[u,g,f]);const O=e=>ie(e),A=e=>{const r=new Map;for(const a of _){if(!a)continue;let s=a[e];if(s==null||(typeof s=="string"?s=s.trim():s=String(s).trim(),!s))continue;const i=s.toLowerCase();r.has(i)||r.set(i,s)}return Array.from(r.values()).sort((a,s)=>a.localeCompare(s))},C=e=>{if(!e)return null;if(typeof e.image=="string"&&e.image.trim())return e.image.trim();if(Array.isArray(e.images)&&e.images.length&&typeof e.images[0]=="string")return e.images[0];if(Array.isArray(e.gallery)&&e.gallery.length&&typeof e.gallery[0]=="string")return e.gallery[0];if(Array.isArray(e.photos)&&e.photos.length&&typeof e.photos[0]=="string")return e.photos[0];const r=["images","gallery","photos"];for(const a of r)if(Array.isArray(e[a])&&e[a].length){const s=e[a][0];if(s&&typeof s=="object"){if(s.src)return s.src;if(s.url)return s.url}}return null},F=_.filter(e=>!w||e.category&&String(e.category)===String(w)).filter(e=>!P||e.subcategory&&String(e.subcategory)===String(P)).filter(e=>e.website_visible===!0).filter(e=>{if(Array.isArray(v)){if(v.length===0)return!1;const r=e.sku||e.part_number||e.id;return r==null?!1:v.includes(String(r).trim().toLowerCase())}return!(u&&e.manufacturer!==u||g&&e.machine_type!==g||f&&e.model!==f)}).filter(e=>!I||Number(e.inventory??e.quantity??0)>0).filter(e=>{if(y&&y.trim()){const r=y.toLowerCase();return e.name&&e.name.toLowerCase().includes(r)||e.part_number&&String(e.part_number).toLowerCase().includes(r)||e.sku&&String(e.sku).toLowerCase().includes(r)}return!0}).sort((e,r)=>N==="price-asc"?(e.price||0)-(r.price||0):N==="price-desc"?(r.price||0)-(e.price||0):0),D=F.length,z=(d-1)*p,U=z+p,W=F.slice(z,U);return t.jsxs("div",{className:"simple-gallery-root",children:[t.jsx(le,{}),t.jsxs("div",{className:"simple-gallery-header",children:[t.jsx("h2",{className:"simple-gallery-title",children:"Search Results"}),t.jsxs("div",{className:"simple-gallery-perpage",children:[t.jsx("label",{className:"filter-label",htmlFor:"perPageSelect",children:"Show:"}),t.jsx("select",{id:"perPageSelect",className:"filter-select",value:p,onChange:e=>{X(Number(e.target.value)),x(1)},children:[24,48,72,96].map(e=>t.jsxs("option",{value:e,children:[e," per page"]},e))})]}),t.jsx("button",{className:"simple-gallery-filter-toggle","aria-label":m?"Hide Filters":"Show Filters","aria-pressed":m,"aria-controls":"gallery-filter-pane",onClick:()=>T(e=>!e),children:"Filter"})]}),t.jsx("hr",{className:"simple-gallery-divider"}),t.jsxs("div",{className:"simple-gallery-layout",children:[t.jsxs("aside",{id:"gallery-filter-pane",className:`simple-gallery-filter-pane${m?"":" simple-gallery-filter-pane--closed"}`,"aria-hidden":!m,children:[t.jsxs("div",{className:"simple-gallery-filter-header",onClick:()=>T(e=>!e),children:["Filters ",m?"▼":"▶"]}),t.jsxs("div",{className:"simple-gallery-filter-content",children:[t.jsx("input",{type:"text",className:"search-input",placeholder:"Search...",value:y,onChange:e=>M(e.target.value)}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Manufacturer"}),t.jsxs("select",{value:u,onChange:e=>R(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Manufacturers"}),(n.manufacturers&&n.manufacturers.length>0?n.manufacturers:A("manufacturer")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Machine Type"}),t.jsxs("select",{value:g,onChange:e=>q(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Machine Types"}),(n.machine_types&&n.machine_types.length>0?n.machine_types:A("machine_type")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Model"}),t.jsxs("select",{value:f,onChange:e=>E(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Models"}),(n.models&&n.models.length>0?n.models:A("model")).map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Sort by"}),t.jsxs("select",{value:N,onChange:e=>K(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"None"}),t.jsx("option",{value:"price-asc",children:"Price: Low to High"}),t.jsx("option",{value:"price-desc",children:"Price: High to Low"})]})]}),t.jsx("div",{className:"filter-section",children:t.jsxs("label",{className:"filter-label",children:[t.jsx("input",{type:"checkbox",checked:I,onChange:e=>V(e.target.checked)})," In-stock only"]})})]})]}),t.jsxs("div",{className:"simple-gallery-grid",style:{marginLeft:0},children:[Q?t.jsx("div",{children:"Loading..."}):L?t.jsxs("div",{children:["Error: ",L]}):W.length===0?t.jsx("div",{children:"No results found."}):W.map(e=>t.jsxs(re,{to:`/product/${e.id}`,className:"simple-gallery-card",style:{textDecoration:"none"},children:[t.jsx("div",{className:"simple-gallery-image-wrapper",children:t.jsx("img",{src:O(C(e)||e.image),alt:e.name,loading:"lazy",onError:r=>{console.log("Image error:",C(e)||e.image,O(C(e)||e.image)),r.currentTarget.src="/logo.png"}})}),e.sku&&t.jsx("div",{className:"simple-gallery-sku",children:e.sku}),t.jsx("h3",{className:"simple-gallery-card-title",title:e.name,children:e.name}),t.jsx("div",{className:"simple-gallery-part-number",children:e.part_number}),t.jsx("div",{className:"simple-gallery-card-price",children:(()=>{const r=Number(e.price);return isNaN(r)?t.jsx("span",{className:"price-current",children:"Price N/A"}):t.jsxs("span",{className:"price-current",children:["$",r.toFixed(2)]})})()}),t.jsx("div",{className:"simple-gallery-card-actions",role:"group","aria-label":"Product Actions",children:(()=>{const r=ae(Y,e.id),a=Number(e.inventory??e.quantity??0);return r>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#f6f6f6",borderRadius:8,padding:"0.2rem 0.5rem"},children:[t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:s=>{s.stopPropagation(),s.preventDefault(),S({type:"SUBTRACT_FROM_CART",product:e})},"aria-label":"Decrease quantity",children:"-"}),t.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1rem"},children:r}),t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:s=>{s.stopPropagation(),s.preventDefault();const i=(r||0)+1,h=Number(e.inventory??e.quantity??0);if(Number.isFinite(h)&&h>0&&i>h){Z(e.id);return}S({type:"ADD_TO_CART",product:e})},"aria-label":"Increase quantity",children:"+"})]}),t.jsx(ne,{productId:e.id})]}):t.jsx("button",{className:"simple-gallery-btn primary",onClick:s=>{s.stopPropagation(),s.preventDefault(),S({type:"ADD_TO_CART",product:e})},title:"Add to Cart","aria-label":a===0?"Out of Stock":"Add to Cart",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:a===0?.5:1,pointerEvents:a===0?"none":"auto",position:"relative"},disabled:a===0,children:t.jsx("span",{className:"add-to-cart-label",style:{fontWeight:800,fontSize:"0.98rem"},children:"Add to Cart"})})})()})]},e.id)),t.jsx("div",{className:"simple-gallery-pagination",children:t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",margin:"2rem auto 0 auto",gap:12,width:"100%"},children:[d>1&&t.jsx("button",{className:"simple-gallery-btn secondary",onClick:()=>x(d-1),children:"< Prev"}),t.jsxs("span",{style:{color:"#c3c3c3",fontWeight:500,fontSize:"1.05rem",margin:"0 1rem"},children:["Page ",d," of ",Math.max(1,Math.ceil(D/p))]}),U<D&&t.jsx("button",{className:"simple-gallery-btn secondary",onClick:()=>x(d+1),children:"Next >"})]})})]})]})]})}export{de as default};
