import{a as N,r as l,u as T,j as e,L as B,g as j}from"./index-DQiy-OUL.js";import{F as M}from"./Footer-BDw9je9_.js";import{g as P}from"./getImageUrl-uc-Sp53x.js";import{S as D}from"./SmartImage-CfQVuS4Q.js";function U(){const{id:k}=N(),[n,R]=l.useState(null),[C,I]=l.useState(!0),[S,F]=l.useState(null),{cart:u,dispatch:x}=T(),c=n&&Number(n.inventory??n.quantity??0),[h,p]=l.useState(0),[f,w]=l.useState([]),[m,v]=l.useState([]),[g,b]=l.useState([]),[z,A]=l.useState([]);return l.useEffect(()=>{const t=new AbortController;return(async()=>{try{const r=await fetch("/.netlify/functions/get-data",{signal:t.signal});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();let o=[];Array.isArray(i)?o=i:i&&Array.isArray(i.products)&&(o=i.products);const a=o.find(d=>String(d.id)===String(k));R(a),i&&Array.isArray(i.compat_links)?A(i.compat_links):A([])}catch(r){r.name!=="AbortError"&&console.error("Failed to fetch products:",r)}finally{I(!1)}})(),()=>t.abort()},[k]),l.useEffect(()=>{if(!n||!n.sku)return;const t=new AbortController,s=n.sku;return fetch(`/.netlify/functions/get-compatibility-by-sku?sku=${encodeURIComponent(s)}`,{signal:t.signal}).then(r=>r.ok?r.json():{compatibility:[]}).then(r=>{r&&Array.isArray(r.compatibility)?b(r.compatibility):b([])}).catch(()=>b([])),()=>t.abort()},[n]),l.useEffect(()=>{if(!n)return;const t=n.image;if(!t)return w([]);const s=String(t).split("/").pop(),r=s.lastIndexOf("."),i=r!==-1?s.slice(0,r):s,o=r!==-1?s.slice(r):"",a=[s];for(let d=2;d<=5;d++)a.push(`${i}_${d}${o}`);Promise.all(a.map(d=>new Promise(W=>{const y=new window.Image,_=P(d);y.src=_,y.onload=()=>W(_),y.onerror=()=>W(null)}))).then(d=>w(d.filter(Boolean))),p(0)},[n]),l.useEffect(()=>{!n||!n.sku||fetch(`/.netlify/functions/get-product-attributes?sku=${encodeURIComponent(n.sku)}`).then(t=>t.json()).then(t=>v(t)).catch(()=>v([]))},[n]),e.jsxs(e.Fragment,{children:[C?e.jsx("div",{style:{textAlign:"center",color:"#888"},children:"Loading product..."}):S?e.jsx("div",{style:{textAlign:"center",color:"red"},children:S}):n?e.jsxs("div",{className:"product-detail-card",style:{maxWidth:"1100px",width:"100%",margin:"1.5rem auto",background:"#fff",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",padding:"1.5rem",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"100%",maxWidth:260,aspectRatio:"4/3",background:"#f8f8f8",borderRadius:8,overflow:"hidden",marginBottom:12,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 6px rgba(0,0,0,0.06)",maxHeight:210},children:f.length>0&&e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx(D,{src:f[h],alt:n.name,style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain",display:"block",margin:"0 auto",background:"none",borderRadius:0},loading:"lazy"}),h>0&&e.jsx("button",{style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>p(h-1),"aria-label":"Previous image",children:"<"}),h<f.length-1&&e.jsx("button",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>p(h+1),"aria-label":"Next image",children:">"}),e.jsxs("div",{style:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",background:"rgba(255,255,255,0.85)",borderRadius:8,padding:"2px 12px",fontSize:14,color:"#444",fontWeight:600},children:[h+1," / ",f.length]})]})}),n.sku&&e.jsx("div",{style:{textAlign:"center",color:"#444a58",fontWeight:500,fontSize:"0.95rem",margin:"6px 0 4px 0"},children:n.sku}),e.jsx("h2",{className:"distressed",style:{fontSize:"1.5rem",marginBottom:6,color:"#333"},children:n.name}),e.jsx("div",{style:{color:"#888",fontSize:"0.98rem",marginBottom:12},children:n.part_number}),e.jsxs("div",{style:{color:"#444a58",fontWeight:700,fontSize:"1.05rem",marginBottom:10},children:[(()=>{const t=Number(n.price),s=Number(n.discount_perc)||0,r=n.discount_end_date?new Date(n.discount_end_date):null,i=new Date;if(s>0&&(!r||i<=r)&&!isNaN(t)){const a=(t*(1-s)).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{textDecoration:"line-through",color:"#888",marginRight:10},children:["$",t.toFixed(2)]}),e.jsxs("span",{style:{color:"#d32f2f",fontWeight:700,fontSize:"1.3rem"},children:["$",a]})]})}else return isNaN(t)?"Price N/A":`$${t.toFixed(2)}`})(),c<20&&c>0?e.jsxs("span",{style:{fontSize:"1rem",color:"orange",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:["Low Stock: ",c," Available"]}):e.jsx("span",{style:{fontSize:"1rem",color:c>0?"#28a745":"#d32f2f",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:c>0?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#28a745",strokeWidth:"2",style:{verticalAlign:"middle"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#28a745",strokeWidth:"2",fill:"#fff"}),e.jsx("path",{d:"M8 12l2 2 4-4",stroke:"#28a745",strokeWidth:"2",fill:"none"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#d32f2f",strokeWidth:"2",style:{verticalAlign:"middle"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#d32f2f",strokeWidth:"2",fill:"#fff"}),e.jsx("line",{x1:"8",y1:"8",x2:"16",y2:"16",stroke:"#d32f2f",strokeWidth:"2"}),e.jsx("line",{x1:"16",y1:"8",x2:"8",y2:"16",stroke:"#d32f2f",strokeWidth:"2"})]}),e.jsx("span",{style:{color:"#d32f2f",marginLeft:6},children:"Out of Stock"})]})})]}),e.jsx("div",{style:{color:"#444a58",fontSize:"1.13rem",marginBottom:24,width:"100%",background:"linear-gradient(90deg, #f8fafc 60%, #f1f5f9 100%)",borderRadius:12,padding:"1.2rem 1.5rem",boxShadow:"0 1px 6px rgba(0,0,0,0.04)"},children:n.description}),e.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap",textShadow:"0 2px 8px 0 rgba(122,133,153,0.18)"},children:"Part Attributes"}),e.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3,boxShadow:"0 4px 16px 0 rgba(122,133,153,0.18)"}})]}),e.jsx("table",{style:{width:"100%",background:"none",fontSize:"1rem",borderCollapse:"collapse",color:"#444a58"},children:e.jsx("tbody",{children:m.length>0?m.map((t,s)=>e.jsxs("tr",{style:{borderBottom:s<m.length-1?"1px solid #ececec":"none",background:s%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0",fontWeight:600,width:"40%"},children:t.attribute_name}),e.jsxs("td",{style:{padding:"8px 0"},children:[t.value_text||t.value_number||(t.value_bool===!0?"Yes":t.value_bool===!1?"No":""),t.unit?` ${t.unit}`:""]})]},t.attribute_name)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,style:{padding:"8px 0",color:"#888"},children:"No attributes available."})})})})]}),e.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap"},children:"Machine Compatibility"}),e.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3}})]}),(()=>{if(!n)return null;if(g&&g.length>0){const i=g;return e.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),e.jsx("tbody",{children:i.map((o,a)=>e.jsxs("tr",{style:{borderBottom:a<i.length-1?"1px solid #ececec":"none",background:a%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0"},children:o.manufacturer||o.manufactur||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:o.machine_type||o.machine||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:o.model||o.models||"-"})]},a))})]})}const t={};for(const i of z||[]){if(!i||!i.machine_compatibility_id)continue;const o=String(i.machine_compatibility_id);t[o]=t[o]||new Set,i.product_sku&&t[o].add(String(i.product_sku))}const s=n.sku?String(n.sku):null;let r=[];if(s&&Object.keys(t).length>0&&g&&g.length>0){const i=new Set;for(const[o,a]of Object.entries(t))a.has(s)&&i.add(o);i.size>0&&(r=g.filter(o=>i.has(String(o.id))))}return e.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),e.jsx("tbody",{children:r&&r.length>0?r.map((i,o)=>e.jsxs("tr",{style:{borderBottom:o<r.length-1?"1px solid #ececec":"none",background:o%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0"},children:i.manufacturer||i.manufactur||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:i.machine_type||i.machine||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:i.model||i.models||"-"})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,style:{padding:"8px 0",color:"#888"},children:"No compatibility information available for this part."})})})]})})()]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",marginTop:32},children:[e.jsx(B,{to:"/catalog",className:"btn btn-lg secondary",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:700,letterSpacing:"0.04em",transition:"background 0.2s",textDecoration:"none",border:"none",cursor:"pointer"},onMouseOver:t=>t.currentTarget.style.background="#e0e0e0",onMouseOut:t=>t.currentTarget.style.background="#f0f0f0",children:"Back to Catalog"}),j(u,n.id)>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#eafbe7",borderRadius:8,padding:"0.5rem 1.2rem"},children:[e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"SUBTRACT_FROM_CART",product:n}),"aria-label":"Decrease quantity",children:"-"}),e.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1.1rem"},children:j(u,n.id)}),e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"ADD_TO_CART",product:n}),"aria-label":"Increase quantity",disabled:j(u,n.id)>=c,children:"+"})]}):e.jsx("button",{className:"btn btn-lg brand",style:{fontWeight:700,letterSpacing:"0.04em",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseOver:t=>t.currentTarget.style.background="#12895c",onMouseOut:t=>t.currentTarget.style.background="#19a974",onClick:()=>x({type:"ADD_TO_CART",product:n}),disabled:c<=0,children:"Add to Cart"})]})]}):null,e.jsx(M,{})]})}export{U as default};
