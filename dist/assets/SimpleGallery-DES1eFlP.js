import{r as o,u as ee,j as t,L as te,g as se}from"./index-gi7GTMaL.js";import{Q as re}from"./QuantityInput-1hGV7dDw.js";import{L as ae}from"./LimitTooltip-BWWIkD2v.js";import{N as ie}from"./Navbar-BEaLdVHS.js";/* empty css                       */import{g as ne}from"./imageUrl-CI4-tccc.js";function ge(){window.matchMedia("(max-width: 700px)").matches;const[N,E]=o.useState([]),[m,q]=o.useState({manufacturers:[],machine_types:[],models:[]}),[b,B]=o.useState({}),[$,T]=o.useState([]),[H,x]=o.useState([]),[w,A]=o.useState(null),[le,U]=o.useState(!0),[oe,Q]=o.useState(null),[j,D]=o.useState(!1),[R,ce]=o.useState(!1),[C,G]=o.useState(""),[d,V]=o.useState(""),[u,L]=o.useState(""),[h,k]=o.useState(""),[O,J]=o.useState("");o.useEffect(()=>{const s=new AbortController;return(async()=>{try{const i=await fetch("/.netlify/functions/get-data",{signal:s.signal});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const e=await i.json();let r=[];if(Array.isArray(e))r=e;else if(e&&Array.isArray(e.products))r=e.products;else if(e&&Array.isArray(e.items))r=e.items;else if(e&&typeof e=="object"){const a=Object.values(e).find(l=>Array.isArray(l));Array.isArray(a)&&(r=a)}E(r);try{const a=(c,...f)=>{for(const y of f){if(!c)continue;const g=c[y];if(g!=null)return g}},l=new Map;for(const c of r){const f=String(a(c,"manufacturer","manufacturer_name","make")||"").trim(),y=String(a(c,"machine_type","machineType","machine")||"").trim(),g=String(a(c,"model","models","model_number")||"").trim();if(!f)continue;l.has(f)||l.set(f,new Map);const _=l.get(f);y&&(_.has(y)||_.set(y,new Set),g&&_.get(y).add(g))}const p={};for(const[c,f]of l.entries()){p[c]={};for(const[y,g]of f.entries())p[c][y]=Array.from(g).sort((_,Z)=>_.localeCompare(Z))}B(p);const S=Array.from(new Set(r.map(c=>String(a(c,"machine_type","machineType","machine")||"").trim()).filter(Boolean))).sort((c,f)=>c.localeCompare(f)),I=Array.from(new Set(r.map(c=>String(a(c,"model","models","model_number")||"").trim()).filter(Boolean))).sort((c,f)=>c.localeCompare(f));T(S),x(I)}catch{}}catch(i){i.name!=="AbortError"&&Q(i.message)}finally{U(!1)}})(),(async()=>{try{const i=await fetch("/.netlify/functions/get-compatibility-options");if(!i.ok)return;const e=await i.json();e&&q({manufacturers:e.manufacturers||[],machine_types:e.machine_types||[],models:e.models||[]})}catch{}})(),()=>s.abort()},[]),o.useEffect(()=>{try{if(!d){T(m.machine_types&&m.machine_types.length?m.machine_types:$),x(m.models&&m.models.length?m.models:H),L(""),k("");return}const s=b[d]||{},n=Object.keys(s).sort((e,r)=>e.localeCompare(r));n.length&&T(n);const i=new Set;for(const e of Object.values(s))for(const r of e)i.add(r);i.size?x(Array.from(i).sort((e,r)=>e.localeCompare(r))):x([]),L(""),k("")}catch{}},[d,b,m]),o.useEffect(()=>{try{if(!u){k("");return}if(d){const s=(b[d]||{})[u]||[];x(s)}else{const s=new Set;for(const n of Object.keys(b||{})){const i=(b[n]||{})[u]||[];for(const e of i)s.add(e)}x(Array.from(s).sort((n,i)=>n.localeCompare(i)))}k("")}catch{x([])}},[u,d,b]),o.useEffect(()=>{if(!d&&!u&&!h){A(null);return}let s=!1;return(async()=>{try{const n=new URLSearchParams;d&&n.set("manufacturer",d),u&&n.set("machine_type",u),h&&n.set("model",h);const i=await fetch("/.netlify/functions/get-compatible-skus?"+n.toString());if(!i.ok){A(null);return}const e=await i.json();if(!s)if(e&&e.skus===null)A(null);else{const r=Array.isArray(e.skus)?e.skus.map(a=>String(a||"").trim().toLowerCase()):[];A(r)}}catch{A(null)}})(),()=>{s=!0}},[d,u,h]);const[M,K]=o.useState(24),[v,F]=o.useState(1),{dispatch:P,cart:X,limitMap:me,showLimit:Y}=ee(),W=s=>ne(s),z=s=>{const n=new Map;for(const i of N){if(!i)continue;let e=i[s];if(e==null||(typeof e=="string"?e=e.trim():e=String(e).trim(),!e))continue;const r=e.toLowerCase();n.has(r)||n.set(r,e)}return Array.from(n.values()).sort((i,e)=>i.localeCompare(e))};return t.jsxs("div",{className:"simple-gallery-root",role:"main",children:[t.jsx(ie,{}),t.jsxs("div",{className:"simple-gallery-header",children:[t.jsx("h2",{className:"simple-gallery-title distressed",children:"Agex Parts"}),t.jsxs("div",{className:"simple-gallery-perpage",children:[t.jsx("label",{className:"filter-label",htmlFor:"perPageSelect",children:"Show:"}),t.jsx("select",{id:"perPageSelect",className:"filter-select",value:M,onChange:s=>{K(Number(s.target.value)),F(1)},children:[24,48,72,96].map(s=>t.jsxs("option",{value:s,children:[s," per page"]},s))})]}),t.jsx("button",{className:"simple-gallery-filter-toggle","aria-label":j?"Hide Filters":"Show Filters","aria-pressed":j,"aria-controls":"gallery-filter-pane",onClick:()=>D(s=>!s),style:{position:"fixed",left:0,top:100,zIndex:100,background:"#3a3939",color:"#f3f3f3",border:"none",borderRadius:"0 8px 8px 0",padding:"0.7rem 0.9rem",fontWeight:700,fontSize:"1.1rem",boxShadow:"0 2px 8px rgba(0,0,0,0.13)",cursor:"pointer",transition:"top 0.3s",display:"block"},id:"filter-toggle-btn",children:t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[t.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),t.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),t.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),t.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),t.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),t.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),t.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),t.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]}),t.jsx("span",{style:{fontSize:"1rem",fontWeight:600},children:"Filter"})]})})]}),t.jsx("hr",{className:"simple-gallery-divider"}),t.jsxs("div",{className:"simple-gallery-layout",style:{position:"relative"},children:[t.jsxs("aside",{id:"gallery-filter-pane",className:`simple-gallery-filter-pane${j?"":" simple-gallery-filter-pane--closed"}`,"aria-label":"Product Filters","aria-hidden":!j,tabIndex:j?0:-1,style:{position:"fixed",left:j?0:-340,top:156,zIndex:99,minWidth:260,maxWidth:340,height:"fit-content",marginTop:0,transition:"top 0.3s, left 0.3s"},children:[t.jsxs("div",{className:"simple-gallery-filter-header",style:{cursor:"pointer"},onClick:()=>D(s=>!s),children:["Filters ",j?"▼":"▶"]}),t.jsxs("div",{className:"simple-gallery-filter-content",children:[t.jsx("input",{type:"text",className:"search-input",placeholder:"Search...",value:C,onChange:s=>G(s.target.value),list:"product-names-list"}),t.jsx("datalist",{id:"product-names-list",children:[...new Set(N.map(s=>s.name).filter(Boolean))].map(s=>t.jsx("option",{value:s},s))}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Manufacturer"}),t.jsxs("select",{value:d,onChange:s=>V(s.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Manufacturers"}),(m.manufacturers&&m.manufacturers.length>0?m.manufacturers:[...new Set(N.map(s=>s.manufacturer).filter(Boolean))]).map(s=>t.jsx("option",{value:s,children:s},s))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Machine Type"}),t.jsxs("select",{value:u,onChange:s=>L(s.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Machine Types"}),(m.machine_types&&m.machine_types.length>0?m.machine_types:z("machine_type")).map(s=>t.jsx("option",{value:s,children:s},s))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Model"}),t.jsxs("select",{value:h,onChange:s=>k(s.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"All Models"}),(m.models&&m.models.length>0?m.models:z("model")).map(s=>t.jsx("option",{value:s,children:s},s))]})]}),t.jsxs("div",{className:"filter-section",children:[t.jsx("label",{className:"filter-label",children:"Sort by"}),t.jsxs("select",{value:O,onChange:s=>J(s.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"None"}),t.jsx("option",{value:"price-asc",children:"Price: Low to High"}),t.jsx("option",{value:"price-desc",children:"Price: High to Low"})]})]})]})]}),t.jsxs("div",{className:"simple-gallery-grid",style:{marginLeft:"",transition:"none"},children:[(()=>{const s=N.filter(e=>e.website_visible===!0).filter(e=>{if(Array.isArray(w)){if(!w.length)return!1;const r=e.sku||e.part_number||e.id;return r==null?!1:w.includes(String(r).trim().toLowerCase())}return!d||e.manufacturer===d}).filter(e=>Array.isArray(w)?!0:!u||e.machine_type===u).filter(e=>Array.isArray(w)?!0:!h||e.model===h).filter(e=>!R||e.quantity>0).filter(e=>{if(!C.trim())return!0;const r=C.toLowerCase();return Object.values(e).some(a=>typeof a=="string"&&a.toLowerCase().includes(r))}).sort((e,r)=>O==="price-asc"?(e.price||0)-(r.price||0):O==="price-desc"?(r.price||0)-(e.price||0):0),n=(v-1)*M,i=n+M;return s.slice(n,i).map(e=>t.jsxs(te,{to:`/product/${e.id}`,className:"simple-gallery-card",style:{textDecoration:"none"},children:[t.jsx("div",{className:"simple-gallery-image-wrapper",children:t.jsx("img",{src:W(e.image),alt:e.name,loading:"lazy",onError:r=>{console.log("Image error:",e.image,W(e.image)),r.currentTarget.src="/logo.png"}})}),e.sku&&t.jsx("div",{className:"simple-gallery-sku",children:e.sku}),t.jsx("h3",{className:"simple-gallery-card-title",title:e.name,children:e.name}),t.jsx("div",{className:"simple-gallery-part-number",children:e.part_number}),t.jsx("div",{className:"simple-gallery-card-price",style:{margin:"8px 0 0 0",fontSize:"1.15rem",fontWeight:700},children:(()=>{const r=Number(e.price),a=Number(e.discount_perc)||0,l=e.discount_end_date?new Date(e.discount_end_date):null,p=new Date;if(a>0&&(!l||p<=l)&&!isNaN(r)){const I=(r*(1-a)).toFixed(2);return t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"price-original",children:["$",r.toFixed(2)]}),t.jsxs("span",{className:"price-current",children:["$",I]})]})}else return isNaN(r)?t.jsx("span",{className:"price-current",children:"Price N/A"}):t.jsxs("span",{className:"price-current",children:["$",r.toFixed(2)]})})()}),t.jsx("div",{className:"simple-gallery-card-actions",role:"group","aria-label":"Product Actions",children:(()=>{const r=se(X,e.id),a=Number(e.inventory??e.quantity??0);return r>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#f6f6f6",borderRadius:8,padding:"0.2rem 0.5rem"},children:[t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:l=>{l.stopPropagation(),l.preventDefault(),P({type:"SUBTRACT_FROM_CART",product:e})},"aria-label":"Decrease quantity",children:"-"}),t.jsx(re,{initialValue:r,product:e,dispatch:P,updateOnBlurOnly:!0,showLimit:l=>{}}),t.jsx("button",{style:{background:"#fff",color:"#333",border:"1px solid #d6d6d6",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.05rem",cursor:"pointer"},onClick:l=>{l.stopPropagation(),l.preventDefault();const p=(r||0)+1,S=Number(e.inventory??e.quantity??0);if(Number.isFinite(S)&&S>0&&p>S){Y(e.id);return}P({type:"ADD_TO_CART",product:e})},"aria-label":"Increase quantity",disabled:r>=a,children:"+"})]}),t.jsx(ae,{productId:e.id})]}):t.jsx("button",{className:"simple-gallery-btn primary",onClick:l=>{l.stopPropagation(),l.preventDefault(),P({type:"ADD_TO_CART",product:e})},title:"Add to Cart","aria-label":a===0?"Out of Stock":"Add to Cart",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:a===0?.5:1,pointerEvents:a===0?"none":"auto",position:"relative"},disabled:a===0,children:t.jsx("span",{className:"add-to-cart-label",style:{fontWeight:800,fontSize:"0.98rem"},children:"Add to Cart"})})})()})]},e.id))})(),t.jsx("div",{className:"simple-gallery-pagination",children:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",margin:"1.2rem auto 0 auto",gap:8,width:"100%"},children:(()=>{const s=N.filter(a=>a.website_visible===!0).filter(a=>!d||a.manufacturer===d).filter(a=>!u||a.machine_type===u).filter(a=>!h||a.model===h).filter(a=>!R||a.quantity>0).filter(a=>{if(!C.trim())return!0;const l=C.toLowerCase();return Object.values(a).some(p=>typeof p=="string"&&p.toLowerCase().includes(l))}).length,n=Math.max(1,Math.ceil(s/M)),i=v>1,e=v<n,r={border:"1px solid #e6e6e6",background:"#fff",padding:"4px 6px",borderRadius:4,cursor:"pointer",minWidth:26,height:26,fontSize:"0.95rem",display:"inline-flex",alignItems:"center",justifyContent:"center"};return t.jsxs(t.Fragment,{children:[t.jsx("button",{"aria-label":"Previous page",onClick:()=>i&&F(v-1),disabled:!i,style:{...r,opacity:i?1:.35},children:"<"}),t.jsxs("div",{style:{padding:"0 6px",color:"#555",fontWeight:600,minWidth:48,textAlign:"center"},children:[v," / ",n]}),t.jsx("button",{"aria-label":"Next page",onClick:()=>e&&F(v+1),disabled:!e,style:{...r,opacity:e?1:.35},children:">"})]})})()})})]})]})]})}export{ge as default};
