import{a as T,r as l,u as B,j as t,L as M,g as j}from"./index-DR_GpTD1.js";import{F as P}from"./Footer-DV7elXJg.js";import{g as _}from"./getImageUrl-uc-Sp53x.js";function F(){const{id:k}=T(),[r,R]=l.useState(null),[C,I]=l.useState(!0),[w,E]=l.useState(null),{cart:p,dispatch:x}=B(),N=e=>{const s=e.currentTarget,o=Number(s.dataset.attempts||0);s.dataset.attempts=o+1;const n=s.getAttribute("src")||"",i=n.startsWith(window.location.origin)?n.slice(window.location.origin.length):n,a=i.split("/").pop()||"";if(o===0){const d=a.toLowerCase();if(d!==a){const h=i.replace(new RegExp(a+"$"),d);s.src=h.startsWith("/")?h:`/${h}`;return}}if(o===1&&i&&i.startsWith("/")){s.src=window.location.origin+i;return}if(o===2){const d=i.startsWith("/")?i.slice(1):i;s.src=d||"/logo.png";return}s.src="/logo.png"},c=r&&Number(r.inventory??r.quantity??0),[g,m]=l.useState(0),[u,S]=l.useState([]),[b,v]=l.useState([]),[f,y]=l.useState([]),[z,W]=l.useState([]);return l.useEffect(()=>{const e=new AbortController;return(async()=>{try{const o=await fetch("/.netlify/functions/get-data",{signal:e.signal});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();let i=[];Array.isArray(n)?i=n:n&&Array.isArray(n.products)&&(i=n.products);const a=i.find(d=>String(d.id)===String(k));R(a),n&&Array.isArray(n.compat_links)?W(n.compat_links):W([])}catch(o){o.name!=="AbortError"&&console.error("Failed to fetch products:",o)}finally{I(!1)}})(),()=>e.abort()},[k]),l.useEffect(()=>{if(!r||!r.sku)return;const e=new AbortController,s=r.sku;return fetch(`/.netlify/functions/get-compatibility-by-sku?sku=${encodeURIComponent(s)}`,{signal:e.signal}).then(o=>o.ok?o.json():{compatibility:[]}).then(o=>{o&&Array.isArray(o.compatibility)?y(o.compatibility):y([])}).catch(()=>y([])),()=>e.abort()},[r]),l.useEffect(()=>{if(!r)return;const e=r.image;if(!e)return S([]);const s=e.lastIndexOf("."),o=s!==-1?e.slice(0,s):e,n=s!==-1?e.slice(s):"",i=[e];for(let a=2;a<=5;a++)i.push(`${o}_${a}${n}`);Promise.all(i.map(a=>new Promise(d=>{const h=new window.Image,A=_(a);h.src=A,h.onload=()=>d(A),h.onerror=()=>d(null)}))).then(a=>S(a.filter(Boolean))),m(0)},[r]),l.useEffect(()=>{!r||!r.sku||fetch(`/.netlify/functions/get-product-attributes?sku=${encodeURIComponent(r.sku)}`).then(e=>e.json()).then(e=>v(e)).catch(()=>v([]))},[r]),t.jsxs(t.Fragment,{children:[C?t.jsx("div",{style:{textAlign:"center",color:"#888"},children:"Loading product..."}):w?t.jsx("div",{style:{textAlign:"center",color:"red"},children:w}):r?t.jsxs("div",{className:"product-detail-card",style:{maxWidth:"1100px",width:"100%",margin:"1.5rem auto",background:"#fff",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",padding:"1.5rem",display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx("div",{style:{width:"100%",maxWidth:260,aspectRatio:"4/3",background:"#f8f8f8",borderRadius:8,overflow:"hidden",marginBottom:12,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 6px rgba(0,0,0,0.06)",maxHeight:210},children:u.length>0&&t.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[t.jsx("img",{src:_(u[g]),alt:r.name,style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain",display:"block",margin:"0 auto",background:"none",borderRadius:0},loading:"lazy",onError:N}),g>0&&t.jsx("button",{style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>m(g-1),"aria-label":"Previous image",children:"<"}),g<u.length-1&&t.jsx("button",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>m(g+1),"aria-label":"Next image",children:">"}),t.jsxs("div",{style:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",background:"rgba(255,255,255,0.85)",borderRadius:8,padding:"2px 12px",fontSize:14,color:"#444",fontWeight:600},children:[g+1," / ",u.length]})]})}),r.sku&&t.jsx("div",{style:{textAlign:"center",color:"#444a58",fontWeight:500,fontSize:"0.95rem",margin:"6px 0 4px 0"},children:r.sku}),t.jsx("h2",{className:"distressed",style:{fontSize:"1.5rem",marginBottom:6,color:"#333"},children:r.name}),t.jsx("div",{style:{color:"#888",fontSize:"0.98rem",marginBottom:12},children:r.part_number}),t.jsxs("div",{style:{color:"#444a58",fontWeight:700,fontSize:"1.05rem",marginBottom:10},children:[(()=>{const e=Number(r.price),s=Number(r.discount_perc)||0,o=r.discount_end_date?new Date(r.discount_end_date):null,n=new Date;if(s>0&&(!o||n<=o)&&!isNaN(e)){const a=(e*(1-s)).toFixed(2);return t.jsxs(t.Fragment,{children:[t.jsxs("span",{style:{textDecoration:"line-through",color:"#888",marginRight:10},children:["$",e.toFixed(2)]}),t.jsxs("span",{style:{color:"#d32f2f",fontWeight:700,fontSize:"1.3rem"},children:["$",a]})]})}else return isNaN(e)?"Price N/A":`$${e.toFixed(2)}`})(),c<20&&c>0?t.jsxs("span",{style:{fontSize:"1rem",color:"orange",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:["Low Stock: ",c," Available"]}):t.jsx("span",{style:{fontSize:"1rem",color:c>0?"#28a745":"#d32f2f",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:c>0?t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#28a745",strokeWidth:"2",style:{verticalAlign:"middle"},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#28a745",strokeWidth:"2",fill:"#fff"}),t.jsx("path",{d:"M8 12l2 2 4-4",stroke:"#28a745",strokeWidth:"2",fill:"none"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#d32f2f",strokeWidth:"2",style:{verticalAlign:"middle"},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#d32f2f",strokeWidth:"2",fill:"#fff"}),t.jsx("line",{x1:"8",y1:"8",x2:"16",y2:"16",stroke:"#d32f2f",strokeWidth:"2"}),t.jsx("line",{x1:"16",y1:"8",x2:"8",y2:"16",stroke:"#d32f2f",strokeWidth:"2"})]}),t.jsx("span",{style:{color:"#d32f2f",marginLeft:6},children:"Out of Stock"})]})})]}),t.jsx("div",{style:{color:"#444a58",fontSize:"1.13rem",marginBottom:24,width:"100%",background:"linear-gradient(90deg, #f8fafc 60%, #f1f5f9 100%)",borderRadius:12,padding:"1.2rem 1.5rem",boxShadow:"0 1px 6px rgba(0,0,0,0.04)"},children:r.description}),t.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap",textShadow:"0 2px 8px 0 rgba(122,133,153,0.18)"},children:"Part Attributes"}),t.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3,boxShadow:"0 4px 16px 0 rgba(122,133,153,0.18)"}})]}),t.jsx("table",{style:{width:"100%",background:"none",fontSize:"1rem",borderCollapse:"collapse",color:"#444a58"},children:t.jsx("tbody",{children:b.length>0?b.map((e,s)=>t.jsxs("tr",{style:{borderBottom:s<b.length-1?"1px solid #ececec":"none",background:s%2===1?"#fafbfc":"none"},children:[t.jsx("td",{style:{padding:"8px 0",fontWeight:600,width:"40%"},children:e.attribute_name}),t.jsxs("td",{style:{padding:"8px 0"},children:[e.value_text||e.value_number||(e.value_bool===!0?"Yes":e.value_bool===!1?"No":""),e.unit?` ${e.unit}`:""]})]},e.attribute_name)):t.jsx("tr",{children:t.jsx("td",{colSpan:2,style:{padding:"8px 0",color:"#888"},children:"No attributes available."})})})})]}),t.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap"},children:"Machine Compatibility"}),t.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3}})]}),(()=>{if(!r)return null;if(f&&f.length>0){const n=f;return t.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),t.jsx("tbody",{children:n.map((i,a)=>t.jsxs("tr",{style:{borderBottom:a<n.length-1?"1px solid #ececec":"none",background:a%2===1?"#fafbfc":"none"},children:[t.jsx("td",{style:{padding:"8px 0"},children:i.manufacturer||i.manufactur||"-"}),t.jsx("td",{style:{padding:"8px 0"},children:i.machine_type||i.machine||"-"}),t.jsx("td",{style:{padding:"8px 0"},children:i.model||i.models||"-"})]},a))})]})}const e={};for(const n of z||[]){if(!n||!n.machine_compatibility_id)continue;const i=String(n.machine_compatibility_id);e[i]=e[i]||new Set,n.product_sku&&e[i].add(String(n.product_sku))}const s=r.sku?String(r.sku):null;let o=[];if(s&&Object.keys(e).length>0&&f&&f.length>0){const n=new Set;for(const[i,a]of Object.entries(e))a.has(s)&&n.add(i);n.size>0&&(o=f.filter(i=>n.has(String(i.id))))}return t.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),t.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),t.jsx("tbody",{children:o&&o.length>0?o.map((n,i)=>t.jsxs("tr",{style:{borderBottom:i<o.length-1?"1px solid #ececec":"none",background:i%2===1?"#fafbfc":"none"},children:[t.jsx("td",{style:{padding:"8px 0"},children:n.manufacturer||n.manufactur||"-"}),t.jsx("td",{style:{padding:"8px 0"},children:n.machine_type||n.machine||"-"}),t.jsx("td",{style:{padding:"8px 0"},children:n.model||n.models||"-"})]},i)):t.jsx("tr",{children:t.jsx("td",{colSpan:3,style:{padding:"8px 0",color:"#888"},children:"No compatibility information available for this part."})})})]})})()]}),t.jsxs("div",{style:{display:"flex",gap:"1.5rem",marginTop:32},children:[t.jsx(M,{to:"/catalog",className:"btn btn-lg secondary",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:700,letterSpacing:"0.04em",transition:"background 0.2s",textDecoration:"none",border:"none",cursor:"pointer"},onMouseOver:e=>e.currentTarget.style.background="#e0e0e0",onMouseOut:e=>e.currentTarget.style.background="#f0f0f0",children:"Back to Catalog"}),j(p,r.id)>0?t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#eafbe7",borderRadius:8,padding:"0.5rem 1.2rem"},children:[t.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"SUBTRACT_FROM_CART",product:r}),"aria-label":"Decrease quantity",children:"-"}),t.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1.1rem"},children:j(p,r.id)}),t.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"ADD_TO_CART",product:r}),"aria-label":"Increase quantity",disabled:j(p,r.id)>=c,children:"+"})]}):t.jsx("button",{className:"btn btn-lg brand",style:{fontWeight:700,letterSpacing:"0.04em",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseOver:e=>e.currentTarget.style.background="#12895c",onMouseOut:e=>e.currentTarget.style.background="#19a974",onClick:()=>x({type:"ADD_TO_CART",product:r}),disabled:c<=0,children:"Add to Cart"})]})]}):null,t.jsx(P,{})]})}export{F as default};
