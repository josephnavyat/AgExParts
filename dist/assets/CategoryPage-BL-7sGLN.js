import{a as I,c as v,r as g,j as a,L as p}from"./index-PZtE8jMc.js";import{g as A}from"./imageUrl-BC-b4leq.js";function E(){const{category:u}=I(),{hash:y}=v(),[d,h]=g.useState(!0),[f,x]=g.useState([]);g.useEffect(()=>{let e=!0;return(async()=>{try{const s=await fetch("/.netlify/functions/get-data");if(!s.ok)throw new Error("fetch failed");const o=await s.json();let c=[];Array.isArray(o)?c=o:o&&Array.isArray(o.products)&&(c=o.products);const l=new Map,m=t=>{if(!t)return null;if(typeof t.image=="string"&&t.image.trim())return t.image.trim();if(Array.isArray(t.images)&&t.images.length&&typeof t.images[0]=="string")return t.images[0];if(Array.isArray(t.gallery)&&t.gallery.length&&typeof t.gallery[0]=="string")return t.gallery[0];if(Array.isArray(t.photos)&&t.photos.length&&typeof t.photos[0]=="string")return t.photos[0];const n=["images","gallery","photos"];for(const i of n)if(Array.isArray(t[i])&&t[i].length){const r=t[i][0];if(r&&typeof r=="object"){if(r.src)return r.src;if(r.url)return r.url}}return null};for(const t of c){const n=(t.category||"").trim(),i=(t.subcategory||"").trim();if(!n||n!==u)continue;l.has(i)||l.set(i,{sample:t,count:0,img:m(t)});const r=l.get(i);r.count=(r.count||0)+1,r.img||(r.img=m(t)),(!r.sample||!m(r.sample))&&(r.sample=t)}const b=Array.from(l.entries()).map(([t,n])=>({subcategory:t,sample:n.sample,sampleImage:n.img}));e&&x(b)}catch(s){console.error("CategoryPage fetch failed",s)}finally{e&&h(!1)}})(),()=>{e=!1}},[u]),g.useEffect(()=>{if(!y)return;const e=decodeURIComponent(y.replace(/^#/,"")),s=document.getElementById(e)||document.getElementById(e.replace(/\s+/g,"-"));s&&setTimeout(()=>s.scrollIntoView({behavior:"smooth",block:"start"}),120)},[y,f]);const j=e=>A(e);return g.useEffect(()=>{const e=()=>{try{const o=document.querySelector(".main-content");if(!o)return;const c=document.querySelector(".nav"),l=c?Math.ceil(c.getBoundingClientRect().height):140,m=o.getBoundingClientRect().top+window.scrollY-l+6;window.scrollTo({top:m,behavior:"auto"})}catch{}};requestAnimationFrame(()=>setTimeout(e,40));const s=setTimeout(e,300);return()=>clearTimeout(s)},[]),a.jsxs("section",{className:"main-content",style:{padding:"28px 20px",maxWidth:1200,margin:"0 auto"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[a.jsx(p,{to:"/categories",style:{fontSize:"0.95rem",color:"#19a974",textDecoration:"none"},children:"← Back to Categories"}),a.jsxs("h2",{className:"category-page__title",style:{margin:0},children:['Subcategories for "',u,'"']})]}),d&&a.jsx("div",{className:"muted",children:"Loading…"}),!d&&f.length===0&&a.jsx("div",{className:"muted",children:"No subcategories found for this category."}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginTop:12},children:f.map(e=>a.jsxs(p,{id:e.subcategory?String(e.subcategory).replace(/\s+/g,"-"):void 0,to:`/search-results?category=${encodeURIComponent(u)}&subcategory=${encodeURIComponent(e.subcategory)}`,className:"card",style:{display:"block",textDecoration:"none",color:"inherit"},children:[a.jsx("div",{style:{height:140,background:"#f4f4f4",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:e.sampleImage||e.sample&&e.sample.image?a.jsx("img",{src:j(e.sampleImage||e.sample&&e.sample.image),alt:e.subcategory,"data-orig":JSON.stringify(e.sampleImage||e.sample&&e.sample.image),loading:"lazy",onError:s=>{try{const o=e.sampleImage||e.sample&&e.sample.image;console.error("CategoryPage image load error - orig:",o,"resolved:",s.currentTarget.src)}catch{}s.currentTarget.onerror=null,s.currentTarget.src="/logo.png"},style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}}):a.jsx("div",{style:{color:"#777"},children:"No image"})}),a.jsx("div",{style:{padding:"12px"},children:a.jsx("h3",{style:{margin:0,fontSize:"1rem"},children:e.subcategory})})]},e.subcategory))})]})}export{E as default};
