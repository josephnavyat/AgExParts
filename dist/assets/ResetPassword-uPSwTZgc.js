import{b,r as o,j as e,d as v}from"./index-BPhBAx7Z.js";import{T as S,C as T}from"./Container-Dt2gv9fs.js";import{c as P,B as f,P as k,T as p,a as C}from"./Paper-GOfKKZax.js";import{T as h}from"./TextField-Ba47FF8D.js";function E(){return new URLSearchParams(v().search)}const R=P({palette:{mode:"light",primary:{main:"#19a974"},background:{default:"#f7f7f7",paper:"#ffffff"},text:{primary:"#222",secondary:"#555"}}});function U(){const i=E(),l=i.get("token")||"",x=i.get("email")||"",g=b(),[r,w]=o.useState(""),[d,y]=o.useState(""),[c,t]=o.useState(""),[m,u]=o.useState(!1);async function j(s){if(s.preventDefault(),t(""),!l){t("Missing token. Use the link from your email.");return}if(!r||r.length<8){t("Password must be at least 8 characters");return}if(r!==d){t("Passwords do not match");return}u(!0);try{const a=await fetch("/.netlify/functions/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:l,password:r,email:x})}),n=await a.json();if(!a.ok)throw new Error(n&&n.error?n.error:"Unknown error");g("/profile?reset=1")}catch(a){t(a.message||"Failed to reset password")}finally{u(!1)}}return e.jsx(S,{theme:R,children:e.jsx(T,{maxWidth:"sm",children:e.jsx(f,{sx:{mt:6},children:e.jsxs(k,{elevation:6,sx:{p:4,borderRadius:3,bgcolor:"background.paper"},children:[e.jsx(p,{variant:"h5",sx:{mb:2},children:"Set a new password"}),e.jsxs("form",{onSubmit:j,children:[e.jsx(h,{label:"New password",type:"password",fullWidth:!0,margin:"normal",value:r,onChange:s=>w(s.target.value)}),e.jsx(h,{label:"Confirm password",type:"password",fullWidth:!0,margin:"normal",value:d,onChange:s=>y(s.target.value)}),c&&e.jsx(p,{color:"error",sx:{mt:1},children:c}),e.jsx(f,{sx:{mt:2},children:e.jsx(C,{type:"submit",variant:"contained",disabled:m,children:m?"Saving...":"Save new password"})})]})]})})})})}export{U as default};
