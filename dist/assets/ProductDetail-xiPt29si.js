import{a as B,r as d,u as M,j as e,L as P,g as k}from"./index-BPhBAx7Z.js";import{F as E}from"./Footer-kmtp9OYe.js";import{g as R}from"./getImageUrl-uc-Sp53x.js";function O(){const{id:w}=B(),[i,C]=d.useState(null),[I,N]=d.useState(!0),[S,$]=d.useState(null),{cart:p,dispatch:x}=M(),z=t=>{const s=t.currentTarget,o=Number(s.dataset.attempts||0);s.dataset.attempts=o+1;const n=s.getAttribute("src")||"",r=n.startsWith(window.location.origin)?n.slice(window.location.origin.length):n,a=r.split("/").pop()||"";if(o===0){const l=a.toLowerCase();if(l!==a){const f=r.replace(new RegExp(a+"$"),l);s.src=f.startsWith("/")?f:`/${f}`;return}}if(o===1&&r&&r.startsWith("/")){s.src=window.location.origin+r;return}if(o===2){const l=r.startsWith("/")?r.slice(1):r;s.src=l||"/logo.png";return}s.src="/logo.png"},c=i&&Number(i.inventory??i.quantity??0),[h,m]=d.useState(0),[u,v]=d.useState([]),[b,W]=d.useState([]),[g,y]=d.useState([]),[T,A]=d.useState([]);return d.useEffect(()=>{const t=new AbortController;return(async()=>{try{const o=await fetch("/.netlify/functions/get-data",{signal:t.signal});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();let r=[];Array.isArray(n)?r=n:n&&Array.isArray(n.products)&&(r=n.products);const a=r.find(l=>String(l.id)===String(w));C(a),n&&Array.isArray(n.compat_links)?A(n.compat_links):A([])}catch(o){o.name!=="AbortError"&&console.error("Failed to fetch products:",o)}finally{N(!1)}})(),()=>t.abort()},[w]),d.useEffect(()=>{if(!i||!i.sku)return;const t=new AbortController,s=i.sku;return fetch(`/.netlify/functions/get-compatibility-by-sku?sku=${encodeURIComponent(s)}`,{signal:t.signal}).then(o=>o.ok?o.json():{compatibility:[]}).then(o=>{o&&Array.isArray(o.compatibility)?y(o.compatibility):y([])}).catch(()=>y([])),()=>t.abort()},[i]),d.useEffect(()=>{if(!i)return;const t=i.image;if(!t)return v([]);const s=String(t).split("/").pop(),o=s.lastIndexOf("."),n=o!==-1?s.slice(0,o):s,r=o!==-1?s.slice(o):"",a=[s];for(let l=2;l<=5;l++)a.push(`${n}_${l}${r}`);Promise.all(a.map(l=>new Promise(f=>{const j=new window.Image,_=R(l);j.src=_,j.onload=()=>f(_),j.onerror=()=>f(null)}))).then(l=>v(l.filter(Boolean))),m(0)},[i]),d.useEffect(()=>{!i||!i.sku||fetch(`/.netlify/functions/get-product-attributes?sku=${encodeURIComponent(i.sku)}`).then(t=>t.json()).then(t=>W(t)).catch(()=>W([]))},[i]),e.jsxs(e.Fragment,{children:[I?e.jsx("div",{style:{textAlign:"center",color:"#888"},children:"Loading product..."}):S?e.jsx("div",{style:{textAlign:"center",color:"red"},children:S}):i?e.jsxs("div",{className:"product-detail-card",style:{maxWidth:"1100px",width:"100%",margin:"1.5rem auto",background:"#fff",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",padding:"1.5rem",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"100%",maxWidth:260,aspectRatio:"4/3",background:"#f8f8f8",borderRadius:8,overflow:"hidden",marginBottom:12,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 6px rgba(0,0,0,0.06)",maxHeight:210},children:u.length>0&&e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx("img",{src:R(u[h]),alt:i.name,style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain",display:"block",margin:"0 auto",background:"none",borderRadius:0},loading:"lazy",onError:z}),h>0&&e.jsx("button",{style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>m(h-1),"aria-label":"Previous image",children:"<"}),h<u.length-1&&e.jsx("button",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"#fff",border:"none",borderRadius:"50%",width:36,height:36,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",cursor:"pointer",fontSize:22,fontWeight:700},onClick:()=>m(h+1),"aria-label":"Next image",children:">"}),e.jsxs("div",{style:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",background:"rgba(255,255,255,0.85)",borderRadius:8,padding:"2px 12px",fontSize:14,color:"#444",fontWeight:600},children:[h+1," / ",u.length]})]})}),i.sku&&e.jsx("div",{style:{textAlign:"center",color:"#444a58",fontWeight:500,fontSize:"0.95rem",margin:"6px 0 4px 0"},children:i.sku}),e.jsx("h2",{className:"distressed",style:{fontSize:"1.5rem",marginBottom:6,color:"#333"},children:i.name}),e.jsx("div",{style:{color:"#888",fontSize:"0.98rem",marginBottom:12},children:i.part_number}),e.jsxs("div",{style:{color:"#444a58",fontWeight:700,fontSize:"1.05rem",marginBottom:10},children:[(()=>{const t=Number(i.price),s=Number(i.discount_perc)||0,o=i.discount_end_date?new Date(i.discount_end_date):null,n=new Date;if(s>0&&(!o||n<=o)&&!isNaN(t)){const a=(t*(1-s)).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{textDecoration:"line-through",color:"#888",marginRight:10},children:["$",t.toFixed(2)]}),e.jsxs("span",{style:{color:"#d32f2f",fontWeight:700,fontSize:"1.3rem"},children:["$",a]})]})}else return isNaN(t)?"Price N/A":`$${t.toFixed(2)}`})(),c<20&&c>0?e.jsxs("span",{style:{fontSize:"1rem",color:"orange",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:["Low Stock: ",c," Available"]}):e.jsx("span",{style:{fontSize:"1rem",color:c>0?"#28a745":"#d32f2f",fontWeight:600,marginLeft:12,display:"inline-flex",alignItems:"center",gap:6},children:c>0?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#28a745",strokeWidth:"2",style:{verticalAlign:"middle"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#28a745",strokeWidth:"2",fill:"#fff"}),e.jsx("path",{d:"M8 12l2 2 4-4",stroke:"#28a745",strokeWidth:"2",fill:"none"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"#d32f2f",strokeWidth:"2",style:{verticalAlign:"middle"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#d32f2f",strokeWidth:"2",fill:"#fff"}),e.jsx("line",{x1:"8",y1:"8",x2:"16",y2:"16",stroke:"#d32f2f",strokeWidth:"2"}),e.jsx("line",{x1:"16",y1:"8",x2:"8",y2:"16",stroke:"#d32f2f",strokeWidth:"2"})]}),e.jsx("span",{style:{color:"#d32f2f",marginLeft:6},children:"Out of Stock"})]})})]}),e.jsx("div",{style:{color:"#444a58",fontSize:"1.13rem",marginBottom:24,width:"100%",background:"linear-gradient(90deg, #f8fafc 60%, #f1f5f9 100%)",borderRadius:12,padding:"1.2rem 1.5rem",boxShadow:"0 1px 6px rgba(0,0,0,0.04)"},children:i.description}),e.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap",textShadow:"0 2px 8px 0 rgba(122,133,153,0.18)"},children:"Part Attributes"}),e.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3,boxShadow:"0 4px 16px 0 rgba(122,133,153,0.18)"}})]}),e.jsx("table",{style:{width:"100%",background:"none",fontSize:"1rem",borderCollapse:"collapse",color:"#444a58"},children:e.jsx("tbody",{children:b.length>0?b.map((t,s)=>e.jsxs("tr",{style:{borderBottom:s<b.length-1?"1px solid #ececec":"none",background:s%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0",fontWeight:600,width:"40%"},children:t.attribute_name}),e.jsxs("td",{style:{padding:"8px 0"},children:[t.value_text||t.value_number||(t.value_bool===!0?"Yes":t.value_bool===!1?"No":""),t.unit?` ${t.unit}`:""]})]},t.attribute_name)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,style:{padding:"8px 0",color:"#888"},children:"No attributes available."})})})})]}),e.jsxs("section",{style:{width:"100%",margin:"0 0 18px 0",background:"none",borderRadius:0,boxShadow:"none",padding:0,marginBottom:18},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"24px 0 14px 0"},children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#3b3b3bff",letterSpacing:"0.01em",textAlign:"left",textTransform:"none",margin:0,paddingRight:16,whiteSpace:"nowrap"},children:"Machine Compatibility"}),e.jsx("div",{style:{flex:1,height:6,background:"#3b3b3bff",borderRadius:3}})]}),(()=>{if(!i)return null;if(g&&g.length>0){const n=g;return e.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),e.jsx("tbody",{children:n.map((r,a)=>e.jsxs("tr",{style:{borderBottom:a<n.length-1?"1px solid #ececec":"none",background:a%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0"},children:r.manufacturer||r.manufactur||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:r.machine_type||r.machine||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:r.model||r.models||"-"})]},a))})]})}const t={};for(const n of T||[]){if(!n||!n.machine_compatibility_id)continue;const r=String(n.machine_compatibility_id);t[r]=t[r]||new Set,n.product_sku&&t[r].add(String(n.product_sku))}const s=i.sku?String(i.sku):null;let o=[];if(s&&Object.keys(t).length>0&&g&&g.length>0){const n=new Set;for(const[r,a]of Object.entries(t))a.has(s)&&n.add(r);n.size>0&&(o=g.filter(r=>n.has(String(r.id))))}return e.jsxs("table",{className:"compat-table",style:{width:"100%",background:"none"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left",borderBottom:"2px solid #ececec"},children:[e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Manufacturer"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"33%"},children:"Machine Type"}),e.jsx("th",{style:{padding:"8px 0",fontWeight:700,width:"34%"},children:"Model"})]})}),e.jsx("tbody",{children:o&&o.length>0?o.map((n,r)=>e.jsxs("tr",{style:{borderBottom:r<o.length-1?"1px solid #ececec":"none",background:r%2===1?"#fafbfc":"none"},children:[e.jsx("td",{style:{padding:"8px 0"},children:n.manufacturer||n.manufactur||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:n.machine_type||n.machine||"-"}),e.jsx("td",{style:{padding:"8px 0"},children:n.model||n.models||"-"})]},r)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,style:{padding:"8px 0",color:"#888"},children:"No compatibility information available for this part."})})})]})})()]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",marginTop:32},children:[e.jsx(P,{to:"/catalog",className:"btn btn-lg secondary",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:700,letterSpacing:"0.04em",transition:"background 0.2s",textDecoration:"none",border:"none",cursor:"pointer"},onMouseOver:t=>t.currentTarget.style.background="#e0e0e0",onMouseOut:t=>t.currentTarget.style.background="#f0f0f0",children:"Back to Catalog"}),k(p,i.id)>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#eafbe7",borderRadius:8,padding:"0.5rem 1.2rem"},children:[e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"SUBTRACT_FROM_CART",product:i}),"aria-label":"Decrease quantity",children:"-"}),e.jsx("span",{style:{minWidth:28,textAlign:"center",fontWeight:600,color:"#222",fontSize:"1.1rem"},children:k(p,i.id)}),e.jsx("button",{style:{background:"#28a745",color:"#fff",border:"none",borderRadius:6,width:32,height:32,fontWeight:700,fontSize:"1.2rem",cursor:"pointer"},onClick:()=>x({type:"ADD_TO_CART",product:i}),"aria-label":"Increase quantity",disabled:k(p,i.id)>=c,children:"+"})]}):e.jsx("button",{className:"btn btn-lg brand",style:{fontWeight:700,letterSpacing:"0.04em",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseOver:t=>t.currentTarget.style.background="#12895c",onMouseOut:t=>t.currentTarget.style.background="#19a974",onClick:()=>x({type:"ADD_TO_CART",product:i}),disabled:c<=0,children:"Add to Cart"})]})]}):null,e.jsx(E,{})]})}export{O as default};
